"use strict";exports.id=690,exports.ids=[690],exports.modules={34690:(a,b,c)=>{c.d(b,{q:()=>y});var d=c(60687),e=c(43210),f=c(27605),g=c(63442),h=c(31692),i=c(63503),j=c(71669),k=c(89667),l=c(29523),m=c(56896),n=c(15079),o=c(58869);let p=(0,c(62688).A)("book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);var q=c(99891),r=c(23928),s=c(40228),t=c(41862),u=c(47814),v=c(52136),w=c(47215);let x=h.Ik({email:h.Yj().min(1,"El email es obligatorio").email("Email inv\xe1lido").max(150,"El email no puede exceder 150 caracteres"),firstName:h.Yj().min(1,"El nombre es obligatorio").min(2,"El nombre debe tener al menos 2 caracteres").max(100,"El nombre no puede exceder 100 caracteres"),lastName:h.Yj().min(1,"El apellido es obligatorio").min(2,"El apellido debe tener al menos 2 caracteres").max(100,"El apellido no puede exceder 100 caracteres"),documentType:h.fc(w.KG),documentNumber:h.Yj().min(1,"El n\xfamero de documento es obligatorio").min(8,"El n\xfamero de documento debe tener al menos 8 caracteres").max(20,"El n\xfamero de documento no puede exceder 20 caracteres"),phone:h.Yj().min(1,"El tel\xe9fono es obligatorio").min(9,"El tel\xe9fono debe tener al menos 9 caracteres").max(20,"El tel\xe9fono no puede exceder 20 caracteres"),university:h.Yj().max(200,"La universidad no puede exceder 200 caracteres").optional(),faculty:h.Yj().max(150,"La facultad no puede exceder 150 caracteres").optional(),career:h.Yj().max(150,"La carrera no puede exceder 150 caracteres").optional(),academicDegree:h.fc(w._J).optional(),role:h.fc(w.gG),isActive:h.zM(),salaryMonth:h.ai().min(0,"El salario debe ser mayor o igual a 0").max(999999,"El salario no puede exceder S/ 999,999").optional(),paymentDate:h.p6().optional()});function y({open:a,onOpenChange:b,onUserSaved:c,user:h=null,mode:y="create"}){let z=(0,v.Tk)(),A=(0,v.Qc)(),[B,C]=(0,e.useState)(!1),D=(0,f.mN)({resolver:(0,g.u)(x),defaultValues:{email:"",firstName:"",lastName:"",documentType:w.KG.DNI,documentNumber:"",phone:"",university:"",faculty:"",career:"",academicDegree:void 0,role:w.gG.COLLABORATOR_EXTERNAL,isActive:!0,salaryMonth:void 0,paymentDate:void 0}}),E=D.watch("role"),F=(0,w.Pi)(E),G=async a=>{if(!B){C(!0);try{if("edit"===y&&h){let b={user:{email:a.email,role:a.role,isActive:a.isActive},profile:{firstName:a.firstName,lastName:a.lastName,documentType:a.documentType,documentNumber:a.documentNumber,phone:a.phone,university:a.university||void 0,faculty:a.faculty||void 0,career:a.career||void 0,academicDegree:a.academicDegree||void 0,salaryMonth:F&&a.salaryMonth||null,paymentDate:F&&a.paymentDate?a.paymentDate.toISOString():null}};await A.mutateAsync({id:h.id,data:b})}else{let b={user:{email:a.email,role:a.role,isActive:a.isActive},profile:{firstName:a.firstName,lastName:a.lastName,documentType:a.documentType,documentNumber:a.documentNumber,phone:a.phone,university:a.university||void 0,faculty:a.faculty||void 0,career:a.career||void 0,academicDegree:a.academicDegree||void 0,salaryMonth:F&&a.salaryMonth||null,paymentDate:F&&a.paymentDate?a.paymentDate.toISOString():null}};await z.mutateAsync(b)}D.reset(),b(!1),c()}catch(a){console.error("Error en operaci\xf3n del usuario:",a)}finally{C(!1)}}},H=z.isPending||A.isPending||B;return(0,d.jsx)(i.lG,{open:a,onOpenChange:b,children:(0,d.jsxs)(i.Cf,{className:"sm:max-w-[900px] max-w-[95vw] max-h-[90vh] overflow-y-auto",onPointerDownOutside:a=>a.preventDefault(),onEscapeKeyDown:a=>a.preventDefault(),children:[(0,d.jsxs)(i.c7,{className:"border-b pb-4",children:[(0,d.jsxs)(i.L3,{className:"flex items-center gap-2",children:[(0,d.jsx)(o.A,{className:"h-5 w-5"}),"edit"===y?"Editar Usuario":"Crear Nuevo Usuario"]}),(0,d.jsx)(i.rr,{children:"edit"===y?"Modifica la informaci\xf3n del usuario, rol y contrato.":"Completa la informaci\xf3n para crear un nuevo usuario. El password ser\xe1 generado autom\xe1ticamente."})]}),(0,d.jsx)(j.lV,{...D,children:(0,d.jsxs)("form",{onSubmit:D.handleSubmit(G),className:"space-y-8",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,d.jsx)(o.A,{className:"h-5 w-5"}),"Informaci\xf3n Personal"]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"email",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Email *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{type:"email",placeholder:"usuario@ejemplo.com",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"phone",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Tel\xe9fono *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"+51987654321",...a})}),(0,d.jsx)(j.C5,{})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"firstName",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Nombres *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"Juan Carlos",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"lastName",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Apellidos *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"P\xe9rez Garc\xeda",...a})}),(0,d.jsx)(j.C5,{})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"documentType",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Tipo de Documento *"}),(0,d.jsxs)(n.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(n.bq,{children:(0,d.jsx)(n.yv,{placeholder:"Seleccionar tipo"})})}),(0,d.jsxs)(n.gC,{children:[(0,d.jsx)(n.eb,{value:w.KG.DNI,children:"DNI"}),(0,d.jsx)(n.eb,{value:w.KG.PASSPORT,children:"Pasaporte"}),(0,d.jsx)(n.eb,{value:w.KG.CE,children:"Carn\xe9 de Extranjer\xeda"})]})]}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"documentNumber",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"N\xfamero de Documento *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"12345678",...a})}),(0,d.jsx)(j.C5,{})]})})]}),(0,d.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,d.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,d.jsx)(p,{className:"h-5 w-5"}),"Informaci\xf3n Acad\xe9mica (Opcional)"]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"university",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Universidad"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"Universidad Nacional Mayor de San Marcos",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"faculty",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Facultad"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"Facultad de Ingenier\xeda",...a})}),(0,d.jsx)(j.C5,{})]})})]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"career",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Carrera"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{placeholder:"Ingenier\xeda de Sistemas",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"academicDegree",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Grado Acad\xe9mico"}),(0,d.jsxs)(n.l6,{onValueChange:a.onChange,value:a.value,children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(n.bq,{children:(0,d.jsx)(n.yv,{placeholder:"Seleccionar grado"})})}),(0,d.jsxs)(n.gC,{children:[(0,d.jsx)(n.eb,{value:w._J.BACHILLER,children:"Bachiller"}),(0,d.jsx)(n.eb,{value:w._J.LICENCIADO,children:"Licenciado"}),(0,d.jsx)(n.eb,{value:w._J.MAGISTER,children:"Magister"}),(0,d.jsx)(n.eb,{value:w._J.DOCTOR,children:"Doctor"})]})]}),(0,d.jsx)(j.C5,{})]})})]})]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,d.jsx)(q.A,{className:"h-5 w-5"}),"Rol y Estado"]}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"role",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Rol del Usuario *"}),(0,d.jsxs)(n.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(n.bq,{children:(0,d.jsx)(n.yv,{placeholder:"Seleccionar rol"})})}),(0,d.jsxs)(n.gC,{children:[(0,d.jsx)(n.eb,{value:w.gG.ADMIN,children:"Admin"}),(0,d.jsx)(n.eb,{value:w.gG.COLLABORATOR_INTERNAL,children:"Colaborador Interno"}),(0,d.jsx)(n.eb,{value:w.gG.COLLABORATOR_EXTERNAL,children:"Colaborador Externo"}),(0,d.jsx)(n.eb,{value:w.gG.RRHH,children:"RRHH"})]})]}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"isActive",render:({field:a})=>(0,d.jsxs)(j.eI,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(m.S,{checked:a.value,onCheckedChange:a.onChange})}),(0,d.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,d.jsx)(j.lR,{children:"Usuario activo"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"El usuario puede acceder al sistema"})]})]})})]})]}),F&&(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,d.jsx)(r.A,{className:"h-5 w-5"}),"Contrato CECAGEM"]}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Informaci\xf3n del salario que CECAGEM pagar\xe1 a este usuario"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:D.control,name:"salaryMonth",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsxs)(j.lR,{className:"flex items-center gap-2",children:[(0,d.jsx)(r.A,{className:"h-4 w-4"}),"Salario Mensual (S/)"]}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.p,{type:"number",placeholder:"2500.50",...a,onChange:b=>a.onChange(b.target.value?Number(b.target.value):void 0),value:a.value||""})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:D.control,name:"paymentDate",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsxs)(j.lR,{className:"flex items-center gap-2",children:[(0,d.jsx)(s.A,{className:"h-4 w-4"}),"Fecha de Pago"]}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(u.J3,{value:a.value,onChange:a.onChange,placeholder:"Seleccionar fecha"})}),(0,d.jsx)(j.C5,{})]})})]})]}),(0,d.jsxs)(i.Es,{className:"gap-2 border-t pt-4",children:[(0,d.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>b(!1),disabled:H,children:"Cancelar"}),(0,d.jsxs)(l.$,{type:"submit",disabled:H,className:"text-white",children:[H&&(0,d.jsx)(t.A,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===y?"Actualizar Usuario":"Crear Usuario"]})]})]})})]})})}},46262:(a,b,c)=>{c.d(b,{D:()=>f});var d=c(86401);let e={users:"/users",userComplete:"/users/complete",user:a=>`/users/${a}`,userProfile:a=>`/users/${a}/profile`,userCompleteUpdate:a=>`/users/${a}/complete`},f={async getUsers(a={}){let b=new URLSearchParams;return b.append("type","users_system"),b.append("page",(a.page||1).toString()),b.append("limit",(a.limit||10).toString()),a.search&&b.append("search",a.search),a.role&&b.append("role",a.role),void 0!==a.isActive&&b.append("isActive",a.isActive.toString()),await d.q.get(`${e.users}?${b.toString()}`)},getUserById:async a=>await d.q.get(e.user(a)),async createUser(a){try{return await d.q.post(e.userComplete,a)}catch(a){throw console.error("❌ Error al crear usuario:",a),a}},async updateUserData(a,b){try{return await d.q.patch(e.user(a),b)}catch(a){throw console.error("❌ Error al actualizar datos de usuario:",a),a}},async updateUserProfile(a,b){try{return await d.q.patch(e.userProfile(a),b)}catch(a){throw console.error("❌ Error al actualizar perfil:",a),a}},async updateUser(a,b){try{return await d.q.patch(e.userCompleteUpdate(a),b)}catch(a){throw console.error("❌ Error al actualizar usuario completo:",a),a}},async deleteUser(a){try{await d.q.delete(e.user(a))}catch(a){throw console.error("❌ Error al eliminar usuario:",a),a}},async validateEmail(a,b){let c=new URLSearchParams;c.append("email",a),b&&c.append("excludeId",b);try{return await d.q.get(`/users/validate-email?${c.toString()}`)}catch(a){return console.error("❌ Error al validar email:",a),{available:!1}}}}},52136:(a,b,c)=>{c.d(b,{Qc:()=>m,Tk:()=>l,ZZ:()=>j,iY:()=>n,kp:()=>k});var d=c(12030),e=c(8693),f=c(54050),g=c(52581),h=c(46262);let i={users:["users"],usersWithFilters:a=>["users",a],user:a=>["users",a],usersStats:["users","stats"]},j=()=>(0,d.useQuery)({queryKey:i.usersStats,queryFn:async()=>{let a=(await h.D.getUsers({limit:1e3})).data,b=a.filter(a=>a.profile.salaryMonth&&a.profile.salaryMonth>0),c=b.reduce((a,b)=>a+(b.profile.salaryMonth||0),0),d=b.length>0?c/b.length:0;return{total:a.length,active:a.filter(a=>a.isActive).length,inactive:a.filter(a=>!a.isActive).length,totalSalaries:c,averageSalary:d}},retry:1,refetchOnWindowFocus:!1}),k=(a={})=>(0,d.useQuery)({queryKey:i.usersWithFilters(a),queryFn:()=>h.D.getUsers(a),retry:1,refetchOnWindowFocus:!1,staleTime:3e4}),l=()=>{let a=(0,e.useQueryClient)();return(0,f.useMutation)({mutationFn:a=>h.D.createUser(a),onSuccess:b=>{a.invalidateQueries({queryKey:i.users}),a.invalidateQueries({queryKey:i.usersStats});let c=b?.profile?.firstName&&b?.profile?.lastName?`${b.profile.firstName} ${b.profile.lastName}`:"Usuario";g.oR.success("Usuario creado correctamente",{description:`${c} ha sido registrado.`})},onError:a=>{console.error("Error al crear usuario:",a);let b=a?.message||"Error al crear el usuario";g.oR.error("Error al crear usuario",{description:b})}})},m=()=>{let a=(0,e.useQueryClient)();return(0,f.useMutation)({mutationFn:({id:a,data:b})=>h.D.updateUser(a,b),onSuccess:b=>{a.invalidateQueries({queryKey:i.users}),a.invalidateQueries({queryKey:i.user(b.id)}),a.invalidateQueries({queryKey:i.usersStats});let c=b?.profile?.firstName&&b?.profile?.lastName?`${b.profile.firstName} ${b.profile.lastName}`:"Usuario";g.oR.success("Usuario actualizado correctamente",{description:`Los datos de ${c} han sido actualizados.`})},onError:a=>{console.error("Error al actualizar usuario:",a);let b=a?.message||"Error al actualizar el usuario";g.oR.error("Error al actualizar usuario",{description:b})}})},n=()=>{let a=(0,e.useQueryClient)();return(0,f.useMutation)({mutationFn:a=>h.D.deleteUser(a),onSuccess:()=>{a.invalidateQueries({queryKey:i.users}),a.invalidateQueries({queryKey:i.usersStats}),g.oR.success("Usuario eliminado correctamente",{description:"El usuario ha sido eliminado del sistema."})},onError:a=>{console.error("Error al eliminar usuario:",a);let b=a?.message||"Error al eliminar el usuario";g.oR.error("Error al eliminar usuario",{description:b})}})}},99891:(a,b,c)=>{c.d(b,{A:()=>d});let d=(0,c(62688).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])}};