"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[464],{5475:(e,r,a)=>{a.d(r,{KG:()=>s,Pi:()=>i,_J:()=>l,gG:()=>t});var s=function(e){return e.DNI="DNI",e.PASSPORT="PASSPORT",e.CE="CE",e}({}),l=function(e){return e.BACHILLER="Bachiller",e.LICENCIADO="Licenciado",e.MAGISTER="Magister",e.DOCTOR="Doctor",e}({}),t=function(e){return e.SUPER_ADMIN="SUPER_ADMIN",e.ADMIN="ADMIN",e.COLLABORATOR_INTERNAL="COLLABORATOR_INTERNAL",e.COLLABORATOR_EXTERNAL="COLLABORATOR_EXTERNAL",e.RRHH="RRHH",e}({});let i=e=>"RRHH"===e||"COLLABORATOR_INTERNAL"===e},7930:(e,r,a)=>{a.d(r,{Qc:()=>m,Tk:()=>u,ZZ:()=>c,iY:()=>h,kp:()=>d});var s=a(95838),l=a(26715),t=a(5041),i=a(56671),o=a(64328);let n={users:["users"],usersWithFilters:e=>["users",e],user:e=>["users",e],usersStats:["users","stats"]},c=()=>(0,s.useQuery)({queryKey:n.usersStats,queryFn:async()=>{let e=(await o.D.getUsers({limit:1e3})).data,r=e.filter(e=>e.profile.salaryMonth&&e.profile.salaryMonth>0),a=r.reduce((e,r)=>e+(r.profile.salaryMonth||0),0),s=r.length>0?a/r.length:0;return{total:e.length,active:e.filter(e=>e.isActive).length,inactive:e.filter(e=>!e.isActive).length,totalSalaries:a,averageSalary:s}},retry:1,refetchOnWindowFocus:!1}),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.useQuery)({queryKey:n.usersWithFilters(e),queryFn:()=>o.D.getUsers(e),retry:1,refetchOnWindowFocus:!1,staleTime:3e4})},u=()=>{let e=(0,l.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>o.D.createUser(e),onSuccess:r=>{var a,s;e.invalidateQueries({queryKey:n.users}),e.invalidateQueries({queryKey:n.usersStats});let l=(null==r||null==(a=r.profile)?void 0:a.firstName)&&(null==r||null==(s=r.profile)?void 0:s.lastName)?"".concat(r.profile.firstName," ").concat(r.profile.lastName):"Usuario";i.oR.success("Usuario creado correctamente",{description:"".concat(l," ha sido registrado.")})},onError:e=>{console.error("Error al crear usuario:",e);let r=(null==e?void 0:e.message)||"Error al crear el usuario";i.oR.error("Error al crear usuario",{description:r})}})},m=()=>{let e=(0,l.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>{let{id:r,data:a}=e;return o.D.updateUser(r,a)},onSuccess:r=>{var a,s;e.invalidateQueries({queryKey:n.users}),e.invalidateQueries({queryKey:n.user(r.id)}),e.invalidateQueries({queryKey:n.usersStats});let l=(null==r||null==(a=r.profile)?void 0:a.firstName)&&(null==r||null==(s=r.profile)?void 0:s.lastName)?"".concat(r.profile.firstName," ").concat(r.profile.lastName):"Usuario";i.oR.success("Usuario actualizado correctamente",{description:"Los datos de ".concat(l," han sido actualizados.")})},onError:e=>{console.error("Error al actualizar usuario:",e);let r=(null==e?void 0:e.message)||"Error al actualizar el usuario";i.oR.error("Error al actualizar usuario",{description:r})}})},h=()=>{let e=(0,l.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>o.D.deleteUser(e),onSuccess:()=>{e.invalidateQueries({queryKey:n.users}),e.invalidateQueries({queryKey:n.usersStats}),i.oR.success("Usuario eliminado correctamente",{description:"El usuario ha sido eliminado del sistema."})},onError:e=>{console.error("Error al eliminar usuario:",e);let r=(null==e?void 0:e.message)||"Error al eliminar el usuario";i.oR.error("Error al eliminar usuario",{description:r})}})}},10464:(e,r,a)=>{a.d(r,{q:()=>A});var s=a(95155),l=a(12115),t=a(62177),i=a(90221),o=a(73162),n=a(54165),c=a(17759),d=a(62523),u=a(30285),m=a(47262),h=a(59409),p=a(71007);let x=(0,a(19946).A)("book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);var j=a(75525),y=a(55868),v=a(69074),g=a(51154),f=a(43126),N=a(7930),E=a(5475);let C=o.Ik({email:o.Yj().min(1,"El email es obligatorio").email("Email inv\xe1lido").max(150,"El email no puede exceder 150 caracteres"),firstName:o.Yj().min(1,"El nombre es obligatorio").min(2,"El nombre debe tener al menos 2 caracteres").max(100,"El nombre no puede exceder 100 caracteres"),lastName:o.Yj().min(1,"El apellido es obligatorio").min(2,"El apellido debe tener al menos 2 caracteres").max(100,"El apellido no puede exceder 100 caracteres"),documentType:o.fc(E.KG),documentNumber:o.Yj().min(1,"El n\xfamero de documento es obligatorio").min(8,"El n\xfamero de documento debe tener al menos 8 caracteres").max(20,"El n\xfamero de documento no puede exceder 20 caracteres"),phone:o.Yj().min(1,"El tel\xe9fono es obligatorio").min(9,"El tel\xe9fono debe tener al menos 9 caracteres").max(20,"El tel\xe9fono no puede exceder 20 caracteres"),university:o.Yj().max(200,"La universidad no puede exceder 200 caracteres").optional(),faculty:o.Yj().max(150,"La facultad no puede exceder 150 caracteres").optional(),career:o.Yj().max(150,"La carrera no puede exceder 150 caracteres").optional(),academicDegree:o.fc(E._J).optional(),role:o.fc(E.gG),isActive:o.zM(),salaryMonth:o.ai().min(0,"El salario debe ser mayor o igual a 0").max(999999,"El salario no puede exceder S/ 999,999").optional(),paymentDate:o.p6().optional()});function A(e){let{open:r,onOpenChange:a,onUserSaved:o,user:A=null,mode:R="create"}=e,b=(0,N.Tk)(),D=(0,N.Qc)(),[M,I]=(0,l.useState)(!1),O=(0,t.mN)({resolver:(0,i.u)(C),defaultValues:{email:"",firstName:"",lastName:"",documentType:E.KG.DNI,documentNumber:"",phone:"",university:"",faculty:"",career:"",academicDegree:void 0,role:E.gG.COLLABORATOR_EXTERNAL,isActive:!0,salaryMonth:void 0,paymentDate:void 0}});(0,l.useEffect)(()=>{"edit"===R&&A&&r?O.reset({email:A.email,firstName:A.profile.firstName,lastName:A.profile.lastName,documentType:A.profile.documentType,documentNumber:A.profile.documentNumber,phone:A.profile.phone,university:A.profile.university||"",faculty:A.profile.faculty||"",career:A.profile.career||"",academicDegree:A.profile.academicDegree||void 0,role:A.role,isActive:A.isActive,salaryMonth:A.profile.salaryMonth||void 0,paymentDate:A.profile.paymentDate?new Date(A.profile.paymentDate):void 0}):"create"===R&&r&&O.reset({email:"",firstName:"",lastName:"",documentType:E.KG.DNI,documentNumber:"",phone:"",university:"",faculty:"",career:"",academicDegree:void 0,role:E.gG.COLLABORATOR_EXTERNAL,isActive:!0,salaryMonth:void 0,paymentDate:void 0})},[R,A,r,O]);let L=O.watch("role"),S=(0,E.Pi)(L);(0,l.useEffect)(()=>{S||(O.setValue("salaryMonth",void 0),O.setValue("paymentDate",void 0))},[S,O]);let w=async e=>{if(!M){I(!0);try{if("edit"===R&&A){let r={user:{email:e.email,role:e.role,isActive:e.isActive},profile:{firstName:e.firstName,lastName:e.lastName,documentType:e.documentType,documentNumber:e.documentNumber,phone:e.phone,university:e.university||void 0,faculty:e.faculty||void 0,career:e.career||void 0,academicDegree:e.academicDegree||void 0,salaryMonth:S&&e.salaryMonth||null,paymentDate:S&&e.paymentDate?e.paymentDate.toISOString():null}};await D.mutateAsync({id:A.id,data:r})}else{let r={user:{email:e.email,role:e.role,isActive:e.isActive},profile:{firstName:e.firstName,lastName:e.lastName,documentType:e.documentType,documentNumber:e.documentNumber,phone:e.phone,university:e.university||void 0,faculty:e.faculty||void 0,career:e.career||void 0,academicDegree:e.academicDegree||void 0,salaryMonth:S&&e.salaryMonth||null,paymentDate:S&&e.paymentDate?e.paymentDate.toISOString():null}};await b.mutateAsync(r)}O.reset(),a(!1),o()}catch(e){console.error("Error en operaci\xf3n del usuario:",e)}finally{I(!1)}}},T=b.isPending||D.isPending||M;return(0,s.jsx)(n.lG,{open:r,onOpenChange:a,children:(0,s.jsxs)(n.Cf,{className:"sm:max-w-[900px] max-w-[95vw] max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,s.jsxs)(n.c7,{className:"border-b pb-4",children:[(0,s.jsxs)(n.L3,{className:"flex items-center gap-2",children:[(0,s.jsx)(p.A,{className:"h-5 w-5"}),"edit"===R?"Editar Usuario":"Crear Nuevo Usuario"]}),(0,s.jsx)(n.rr,{children:"edit"===R?"Modifica la informaci\xf3n del usuario, rol y contrato.":"Completa la informaci\xf3n para crear un nuevo usuario. El password ser\xe1 generado autom\xe1ticamente."})]}),(0,s.jsx)(c.lV,{...O,children:(0,s.jsxs)("form",{onSubmit:O.handleSubmit(w),className:"space-y-8",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,s.jsx)(p.A,{className:"h-5 w-5"}),"Informaci\xf3n Personal"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"email",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Email *"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{type:"email",placeholder:"usuario@ejemplo.com",...r})}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"phone",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Tel\xe9fono *"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"+51987654321",...r})}),(0,s.jsx)(c.C5,{})]})}})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"firstName",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Nombres *"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"Juan Carlos",...r})}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"lastName",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Apellidos *"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"P\xe9rez Garc\xeda",...r})}),(0,s.jsx)(c.C5,{})]})}})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"documentType",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Tipo de Documento *"}),(0,s.jsxs)(h.l6,{onValueChange:r.onChange,defaultValue:r.value,children:[(0,s.jsx)(c.MJ,{children:(0,s.jsx)(h.bq,{children:(0,s.jsx)(h.yv,{placeholder:"Seleccionar tipo"})})}),(0,s.jsxs)(h.gC,{children:[(0,s.jsx)(h.eb,{value:E.KG.DNI,children:"DNI"}),(0,s.jsx)(h.eb,{value:E.KG.PASSPORT,children:"Pasaporte"}),(0,s.jsx)(h.eb,{value:E.KG.CE,children:"Carn\xe9 de Extranjer\xeda"})]})]}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"documentNumber",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"N\xfamero de Documento *"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"12345678",...r})}),(0,s.jsx)(c.C5,{})]})}})]}),(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,s.jsx)(x,{className:"h-5 w-5"}),"Informaci\xf3n Acad\xe9mica (Opcional)"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"university",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Universidad"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"Universidad Nacional Mayor de San Marcos",...r})}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"faculty",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Facultad"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"Facultad de Ingenier\xeda",...r})}),(0,s.jsx)(c.C5,{})]})}})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"career",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Carrera"}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{placeholder:"Ingenier\xeda de Sistemas",...r})}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"academicDegree",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Grado Acad\xe9mico"}),(0,s.jsxs)(h.l6,{onValueChange:r.onChange,value:r.value,children:[(0,s.jsx)(c.MJ,{children:(0,s.jsx)(h.bq,{children:(0,s.jsx)(h.yv,{placeholder:"Seleccionar grado"})})}),(0,s.jsxs)(h.gC,{children:[(0,s.jsx)(h.eb,{value:E._J.BACHILLER,children:"Bachiller"}),(0,s.jsx)(h.eb,{value:E._J.LICENCIADO,children:"Licenciado"}),(0,s.jsx)(h.eb,{value:E._J.MAGISTER,children:"Magister"}),(0,s.jsx)(h.eb,{value:E._J.DOCTOR,children:"Doctor"})]})]}),(0,s.jsx)(c.C5,{})]})}})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,s.jsx)(j.A,{className:"h-5 w-5"}),"Rol y Estado"]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"role",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsx)(c.lR,{children:"Rol del Usuario *"}),(0,s.jsxs)(h.l6,{onValueChange:r.onChange,defaultValue:r.value,children:[(0,s.jsx)(c.MJ,{children:(0,s.jsx)(h.bq,{children:(0,s.jsx)(h.yv,{placeholder:"Seleccionar rol"})})}),(0,s.jsxs)(h.gC,{children:[(0,s.jsx)(h.eb,{value:E.gG.ADMIN,children:"Admin"}),(0,s.jsx)(h.eb,{value:E.gG.COLLABORATOR_INTERNAL,children:"Colaborador Interno"}),(0,s.jsx)(h.eb,{value:E.gG.COLLABORATOR_EXTERNAL,children:"Colaborador Externo"}),(0,s.jsx)(h.eb,{value:E.gG.RRHH,children:"RRHH"})]})]}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"isActive",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[(0,s.jsx)(c.MJ,{children:(0,s.jsx)(m.S,{checked:r.value,onCheckedChange:r.onChange})}),(0,s.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,s.jsx)(c.lR,{children:"Usuario activo"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"El usuario puede acceder al sistema"})]})]})}})]})]}),S&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,s.jsx)(y.A,{className:"h-5 w-5"}),"Contrato CECAGEM"]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Informaci\xf3n del salario que CECAGEM pagar\xe1 a este usuario"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(c.zB,{control:O.control,name:"salaryMonth",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsxs)(c.lR,{className:"flex items-center gap-2",children:[(0,s.jsx)(y.A,{className:"h-4 w-4"}),"Salario Mensual (S/)"]}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(d.p,{type:"number",placeholder:"2500.50",...r,onChange:e=>r.onChange(e.target.value?Number(e.target.value):void 0),value:r.value||""})}),(0,s.jsx)(c.C5,{})]})}}),(0,s.jsx)(c.zB,{control:O.control,name:"paymentDate",render:e=>{let{field:r}=e;return(0,s.jsxs)(c.eI,{children:[(0,s.jsxs)(c.lR,{className:"flex items-center gap-2",children:[(0,s.jsx)(v.A,{className:"h-4 w-4"}),"Fecha de Pago"]}),(0,s.jsx)(c.MJ,{children:(0,s.jsx)(f.J3,{value:r.value,onChange:r.onChange,placeholder:"Seleccionar fecha"})}),(0,s.jsx)(c.C5,{})]})}})]})]}),(0,s.jsxs)(n.Es,{className:"gap-2 border-t pt-4",children:[(0,s.jsx)(u.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:T,children:"Cancelar"}),(0,s.jsxs)(u.$,{type:"submit",disabled:T,className:"text-white",children:[T&&(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===R?"Actualizar Usuario":"Crear Usuario"]})]})]})})]})})}},64328:(e,r,a)=>{a.d(r,{D:()=>t});var s=a(90697);let l={users:"/users",userComplete:"/users/complete",user:e=>"/users/".concat(e),userProfile:e=>"/users/".concat(e,"/profile"),userCompleteUpdate:e=>"/users/".concat(e,"/complete")},t={async getUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new URLSearchParams;return r.append("type","users_system"),r.append("page",(e.page||1).toString()),r.append("limit",(e.limit||10).toString()),e.search&&r.append("search",e.search),e.role&&r.append("role",e.role),void 0!==e.isActive&&r.append("isActive",e.isActive.toString()),await s.q.get("".concat(l.users,"?").concat(r.toString()))},getUserById:async e=>await s.q.get(l.user(e)),async createUser(e){try{return await s.q.post(l.userComplete,e)}catch(e){throw console.error("❌ Error al crear usuario:",e),e}},async updateUserData(e,r){try{return await s.q.patch(l.user(e),r)}catch(e){throw console.error("❌ Error al actualizar datos de usuario:",e),e}},async updateUserProfile(e,r){try{return await s.q.patch(l.userProfile(e),r)}catch(e){throw console.error("❌ Error al actualizar perfil:",e),e}},async updateUser(e,r){try{return await s.q.patch(l.userCompleteUpdate(e),r)}catch(e){throw console.error("❌ Error al actualizar usuario completo:",e),e}},async deleteUser(e){try{await s.q.delete(l.user(e))}catch(e){throw console.error("❌ Error al eliminar usuario:",e),e}},async validateEmail(e,r){let a=new URLSearchParams;a.append("email",e),r&&a.append("excludeId",r);try{return await s.q.get("/users/validate-email?".concat(a.toString()))}catch(e){return console.error("❌ Error al validar email:",e),{available:!1}}}}},75525:(e,r,a)=>{a.d(r,{A:()=>s});let s=(0,a(19946).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])}}]);