"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5104],{17313:(e,t,a)=>{a.d(t,{Xi:()=>l,av:()=>c,j7:()=>o,tU:()=>i});var r=a(95155);a(12115);var s=a(61366),n=a(59434);function i(e){let{className:t,...a}=e;return(0,r.jsx)(s.bL,{"data-slot":"tabs",className:(0,n.cn)("flex flex-col gap-2",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)(s.B8,{"data-slot":"tabs-list",className:(0,n.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)(s.l9,{"data-slot":"tabs-trigger",className:(0,n.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)(s.UC,{"data-slot":"tabs-content",className:(0,n.cn)("flex-1 outline-none",t),...a})}},19853:(e,t,a)=>{a.d(t,{D5:()=>g,U0:()=>p,k6:()=>m,ku:()=>d,n:()=>c,n9:()=>u});var r=a(95838),s=a(26715),n=a(5041),i=a(79377),o=a(87481);let l={all:["contracts"],lists:()=>[...l.all,"list"],list:e=>[...l.lists(),e],details:()=>[...l.all,"detail"],detail:e=>[...l.details(),e]},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,r.useQuery)({queryKey:l.list(e),queryFn:()=>i.U.getContracts(e),retry:1,refetchOnWindowFocus:!0,staleTime:0})},d=e=>(0,r.useQuery)({queryKey:l.detail(e),queryFn:()=>i.U.getContractById(e),enabled:!!e,retry:1,refetchOnWindowFocus:!1}),u=()=>{let e=(0,s.useQueryClient)(),{showSuccess:t,showError:a}=(0,o.d)();return(0,n.useMutation)({mutationFn:e=>i.U.deleteContract(e),onSuccess:(a,r)=>{e.invalidateQueries({queryKey:l.all}),e.removeQueries({queryKey:l.detail(r)}),t("deleted",{title:"Contrato eliminado",description:a.message||"El contrato ha sido eliminado exitosamente"})},onError:e=>{a("error",{title:"Error al eliminar",description:(null==e?void 0:e.message)||"No se pudo eliminar el contrato"})}})},m=()=>{let e=(0,s.useQueryClient)(),{showSuccess:t,showError:a}=(0,o.d)();return(0,n.useMutation)({mutationFn:e=>{let{contractId:t,deliverableId:a,data:r}=e;return i.U.updateDeliverable(t,a,r)},onSuccess:async a=>{await e.invalidateQueries({queryKey:l.all}),await e.invalidateQueries({queryKey:l.lists()}),await e.refetchQueries({queryKey:l.lists(),exact:!1});let r="Entregable actualizado",s="El entregable ha sido actualizado exitosamente";!0===a.isAproved&&!0===a.isCompleted?(r="Entregable aprobado",s="El entregable ha sido aprobado exitosamente"):!1===a.isAproved&&!1===a.isCompleted&&(r="Entregable rechazado",s="El entregable ha sido rechazado y vuelve a estar en progreso"),t("updated",{title:r,description:s})},onError:e=>{a("error",{title:"Error al actualizar",description:(null==e?void 0:e.message)||"No se pudo actualizar el entregable"})}})},p=()=>{let e=(0,s.useQueryClient)(),{showSuccess:t,showError:a}=(0,o.d)();return(0,n.useMutation)({mutationFn:e=>i.U.createContract(e),onSuccess:a=>(e.invalidateQueries({queryKey:l.all}),t("created",{title:"Contrato creado",description:'El contrato "'.concat(a.name,'" ha sido creado exitosamente')}),a),onError:e=>{a("error",{title:"Error al crear",description:(null==e?void 0:e.message)||"No se pudo crear el contrato"})}})},g=()=>{let e=(0,s.useQueryClient)(),{showSuccess:t,showError:a}=(0,o.d)();return(0,n.useMutation)({mutationFn:e=>{let{paymentId:t,data:a}=e;return i.U.updatePayment(t,a)},onSuccess:async a=>{await e.invalidateQueries({queryKey:l.all}),await e.invalidateQueries({queryKey:l.lists()}),await e.refetchQueries({queryKey:l.lists(),exact:!1});let r="COMPLETED"===a.status?"aprobado":"FAILED"===a.status?"rechazado":"actualizado";t("updated",{title:"Pago actualizado",description:"El pago ha sido ".concat(r," exitosamente")})},onError:e=>{a("error",{title:"Error al actualizar pago",description:(null==e?void 0:e.message)||"No se pudo actualizar el pago"})}})}},29869:(e,t,a)=>{a.d(t,{A:()=>r});let r=(0,a(19946).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},45546:(e,t,a)=>{a.d(t,{q:()=>x});var r=a(95155),s=a(12115),n=a(54165),i=a(66695),o=a(26126),l=a(30285),c=a(40646),d=a(54416),u=a(14186),m=a(85339),p=a(81586),g=a(69074),h=a(19853);let x=e=>{let{open:t,onOpenChange:a,payments:x,installmentDescription:y="Cuota",canManagePayments:v=!1}=e,[b,f]=(0,s.useState)(null),w=(0,h.D5)(),N=async e=>{f(e);try{await w.mutateAsync({paymentId:e,data:{status:"COMPLETED"}}),a(!1)}catch(e){console.error("Error al aprobar pago:",e)}finally{f(null)}},E=async e=>{f(e);try{await w.mutateAsync({paymentId:e,data:{status:"FAILED"}}),a(!1)}catch(e){console.error("Error al rechazar pago:",e)}finally{f(null)}};return(0,r.jsx)(n.lG,{open:t,onOpenChange:a,children:(0,r.jsxs)(n.Cf,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)(n.c7,{children:[(0,r.jsxs)(n.L3,{className:"flex items-center gap-2",children:[(0,r.jsx)(p.A,{className:"h-5 w-5"}),"Pagos de ",y]}),(0,r.jsx)(n.rr,{children:"Detalle de los pagos realizados para esta cuota"})]}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("h4",{className:"font-medium text-sm text-muted-foreground",children:"Historial de Pagos"}),x.length>0?(0,r.jsx)("div",{className:"space-y-3",children:x.map((e,t)=>{let a;return(0,r.jsx)(i.Zp,{className:"border-l-4 ".concat("COMPLETED"===e.status?"border-l-green-500":"FAILED"===e.status?"border-l-red-500":"PENDING"===e.status?"border-l-yellow-500":"border-l-gray-500"),children:(0,r.jsx)(i.Wu,{className:"p-4",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"h-10 w-10 rounded-full flex items-center justify-center ".concat("COMPLETED"===e.status?"bg-green-100 dark:bg-green-900/30":"FAILED"===e.status?"bg-red-100 dark:bg-red-900/30":"PENDING"===e.status?"bg-yellow-100 dark:bg-yellow-900/30":"bg-gray-100 dark:bg-gray-900/30"),children:(e=>{switch(e){case"COMPLETED":return(0,r.jsx)(c.A,{className:"h-4 w-4 text-green-600"});case"FAILED":return(0,r.jsx)(d.A,{className:"h-4 w-4 text-red-600"});case"PENDING":return(0,r.jsx)(u.A,{className:"h-4 w-4 text-yellow-600"});default:return(0,r.jsx)(m.A,{className:"h-4 w-4 text-gray-600"})}})(e.status)}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-medium text-sm",children:["Pago #",t+1]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,r.jsx)(g.A,{className:"h-3 w-3"}),new Date(e.createdAt).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,r.jsx)("div",{className:"text-right",children:(0,r.jsx)(o.E,{className:(e=>{switch(e){case"COMPLETED":return"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300";case"FAILED":return"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300";case"PENDING":return"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300";default:return"bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-300"}})(e.status),children:(e=>{switch(e){case"COMPLETED":return"Aprobado";case"FAILED":return"Rechazado";case"PENDING":return"Pendiente";default:return e}})(e.status)})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Monto"}),(0,r.jsx)("p",{className:"font-semibold",children:(a=e.amount,new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:2}).format(a))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"M\xe9todo"}),(0,r.jsx)("p",{className:"font-medium",children:e.method})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-muted-foreground",children:"Nro. Operaci\xf3n"}),(0,r.jsx)("p",{className:"font-mono text-xs",children:e.reference||"No especificado"})]})]}),v&&"PENDING"===e.status&&(0,r.jsxs)("div",{className:"flex gap-2 pt-2 border-t",children:[(0,r.jsxs)(l.$,{size:"sm",onClick:()=>N(e.id),disabled:b===e.id,className:"flex-1 bg-green-600 hover:bg-green-700",children:[(0,r.jsx)(c.A,{className:"h-4 w-4 mr-2"}),b===e.id?"Aprobando...":"Aprobar"]}),(0,r.jsxs)(l.$,{size:"sm",variant:"destructive",onClick:()=>E(e.id),disabled:b===e.id,className:"flex-1",children:[(0,r.jsx)(d.A,{className:"h-4 w-4 mr-2"}),b===e.id?"Rechazando...":"Rechazar"]})]})]})})},e.id)})}):(0,r.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,r.jsx)(p.A,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),(0,r.jsx)("p",{className:"text-sm",children:"No hay pagos registrados para esta cuota"})]})]})})]})})}},79377:(e,t,a)=>{a.d(t,{U:()=>i});var r=a(90697);let s={contracts:"/contract",contract:e=>"/contract/".concat(e),deliverable:(e,t)=>"/contract/".concat(e,"/deliverables/").concat(t)};class n{async getContracts(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new URLSearchParams;e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString()),e.search&&t.append("search",e.search),e.serviceId&&t.append("serviceId",e.serviceId),e.sortBy&&t.append("sortBy",e.sortBy),e.sortOrder&&t.append("sortOrder",e.sortOrder);let a=t.toString(),n=a?"".concat(s.contracts,"?").concat(a):s.contracts;return await r.q.get(n)}async getContractById(e){return await r.q.get(s.contract(e))}async deleteContract(e){return await r.q.delete(s.contract(e))}async createContract(e){return await r.q.post(s.contracts,e)}async updateContract(e,t){return await r.q.patch(s.contract(e),t)}async updateDeliverable(e,t,a){return await r.q.patch(s.deliverable(e,t),a)}async updatePayment(e,t){return await r.q.patch("/payments/".concat(e),t)}}let i=new n;a(81630)},81497:(e,t,a)=>{a.d(t,{A:()=>r});let r=(0,a(19946).A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},81630:(e,t,a)=>{a.d(t,{M:()=>n});var r=a(90697);class s{async createPayment(e){return await r.q.post("/payments",e)}}let n=new s},87481:(e,t,a)=>{a.d(t,{d:()=>d});var r=a(12115),s=a(56671),n=a(43453),i=a(85339),o=a(1243),l=a(81284);let c={success:{created:{title:"\xa1Operaci\xf3n exitosa!",description:"El elemento ha sido creado correctamente."},updated:{title:"\xa1Actualizaci\xf3n exitosa!",description:"Los cambios han sido guardados correctamente."},deleted:{title:"\xa1Eliminaci\xf3n exitosa!",description:"El elemento ha sido eliminado del sistema."}},error:{error:{title:"Error en la operaci\xf3n",description:"Ha ocurrido un problema. Por favor intenta nuevamente."},created:{title:"Error al crear",description:"No se pudo crear el elemento. Verifica los datos e intenta nuevamente."},updated:{title:"Error al actualizar",description:"No se pudieron guardar los cambios. Intenta nuevamente."},deleted:{title:"Error al eliminar",description:"No se pudo eliminar el elemento. Intenta nuevamente."}},warning:{created:{title:"Creado con advertencias",description:"La operaci\xf3n se complet\xf3 pero hay algunos aspectos a revisar."},updated:{title:"Actualizado con advertencias",description:"Los cambios se guardaron pero hay algunos aspectos a revisar."},deleted:{title:"Eliminado con advertencias",description:"La eliminaci\xf3n se complet\xf3 pero hay algunos aspectos a revisar."}},info:{created:{title:"Informaci\xf3n",description:"El elemento ha sido creado. Revisa los detalles adicionales."},updated:{title:"Informaci\xf3n",description:"Los cambios han sido aplicados. Revisa los detalles."},deleted:{title:"Informaci\xf3n",description:"El elemento ha sido eliminado del sistema."}}};function d(){let e=(e,t,a)=>{var d;let u=t&&(null==(d=c[e])?void 0:d[t]),m=(null==a?void 0:a.title)||(null==u?void 0:u.title)||"Notificaci\xf3n",p={description:(null==a?void 0:a.description)||(null==u?void 0:u.description),duration:(null==a?void 0:a.duration)||4e3,icon:r.createElement(function(e){switch(e){case"success":return n.A;case"error":return i.A;case"warning":return o.A;default:return l.A}}(e),{className:"h-4 w-4"})};switch(e){case"success":s.oR.success(m,p);break;case"error":s.oR.error(m,p);break;case"warning":s.oR.warning(m,p);break;case"info":s.oR.info(m,p);break;default:(0,s.oR)(m,p)}};return{showToast:e,showSuccess:(t,a)=>{e("success",t,a)},showError:(t,a)=>{e("error",t,a)},showWarning:(t,a)=>{e("warning",t,a)},showInfo:(t,a)=>{e("info",t,a)},showCustomSuccess:(t,a,r)=>{e("success",void 0,{title:t,description:a,duration:r})},showCustomError:(t,a,r)=>{e("error",void 0,{title:t,description:a,duration:r})},showCustomWarning:(t,a,r)=>{e("warning",void 0,{title:t,description:a,duration:r})},showCustomInfo:(t,a,r)=>{e("info",void 0,{title:t,description:a,duration:r})}}}},88539:(e,t,a)=>{a.d(t,{T:()=>n});var r=a(95155);a(12115);var s=a(59434);function n(e){let{className:t,...a}=e;return(0,r.jsx)("textarea",{className:(0,s.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}}}]);