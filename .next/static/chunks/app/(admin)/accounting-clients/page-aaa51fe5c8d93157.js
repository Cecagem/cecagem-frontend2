(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3168],{13717:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(19946).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},17313:(e,s,a)=>{"use strict";a.d(s,{Xi:()=>i,av:()=>d,j7:()=>c,tU:()=>l});var t=a(95155);a(12115);var r=a(61366),n=a(59434);function l(e){let{className:s,...a}=e;return(0,t.jsx)(r.bL,{"data-slot":"tabs",className:(0,n.cn)("flex flex-col gap-2",s),...a})}function c(e){let{className:s,...a}=e;return(0,t.jsx)(r.B8,{"data-slot":"tabs-list",className:(0,n.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...a})}function i(e){let{className:s,...a}=e;return(0,t.jsx)(r.l9,{"data-slot":"tabs-trigger",className:(0,n.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a})}function d(e){let{className:s,...a}=e;return(0,t.jsx)(r.UC,{"data-slot":"tabs-content",className:(0,n.cn)("flex-1 outline-none",s),...a})}},33109:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(19946).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},33240:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>el});var t=a(95155),r=a(91165),n=a(19018),l=a(30285),c=a(22346),i=a(3501),d=a(23861),o=a(12115),m=a(84616),x=a(42143),u=a(47924),h=a(62523),j=a(59409),g=a(66695);let p=e=>{let{filters:s,onFiltersChange:a,onClearFilters:r,isLoading:n=!1}=e,c=(e,t)=>{a({...s,[e]:t})},i=Object.values(s).some(e=>void 0!==e&&""!==e&&null!==e&&"all"!==e);return(0,t.jsx)(g.Zp,{children:(0,t.jsx)(g.Wu,{className:"space-y-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(u.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(h.p,{placeholder:"Buscar por empresa o RUC",value:s.search||"",onChange:e=>c("search",e.target.value),className:"pl-10",disabled:n})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)(j.l6,{value:void 0===s.isActive?"all":s.isActive.toString(),onValueChange:e=>{"all"===e?c("isActive",void 0):c("isActive","true"===e)},disabled:n,children:[(0,t.jsx)(j.bq,{children:(0,t.jsx)(j.yv,{placeholder:"Todos los estados"})}),(0,t.jsxs)(j.gC,{children:[(0,t.jsx)(j.eb,{value:"all",children:"Todos los estados"}),(0,t.jsx)(j.eb,{value:"true",children:"Activo"}),(0,t.jsx)(j.eb,{value:"false",children:"Inactivo"})]})]})}),(0,t.jsx)("div",{children:i&&(0,t.jsx)(l.$,{variant:"outline",onClick:r,disabled:n,className:"w-full",children:"Limpiar Filtros"})})]})})})};var N=a(31455),v=a(13439),f=a(71007),b=a(13717),y=a(62525),E=a(23227),C=a(88889),w=a(90010),A=a(26126),P=a(17313),D=a(81586),k=a(4516),I=a(19420),M=a(28883),L=a(14186),z=a(55868),S=a(69074),R=a(92657),O=function(e){return e.PENDING="PENDING",e.COMPLETED="COMPLETED",e.FAILED="FAILED",e.CANCELLED="CANCELLED",e}({}),F=a(54165),T=a(40646),B=a(54416),G=a(85339);let J=e=>{let{open:s,onOpenChange:a,payments:r,installmentDescription:n="Cuota",canManagePayments:c=!1}=e,[i,d]=(0,o.useState)(null),m=(0,x.D5)(),u=async e=>{d(e);try{await m.mutateAsync({paymentId:e,data:{status:"COMPLETED"}}),a(!1)}catch(e){console.error("Error al aprobar pago:",e)}finally{d(null)}},h=async e=>{d(e);try{await m.mutateAsync({paymentId:e,data:{status:"FAILED"}}),a(!1)}catch(e){console.error("Error al rechazar pago:",e)}finally{d(null)}},j=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PEN";return new Intl.NumberFormat("es-PE",{style:"currency",currency:s,minimumFractionDigits:2}).format(e)};return(0,t.jsx)(F.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(F.Cf,{className:"sm:max-w-[600px] max-w-[95vw] max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(F.c7,{children:[(0,t.jsxs)(F.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(D.A,{className:"h-5 w-5"}),"Pagos de ",n]}),(0,t.jsx)(F.rr,{children:"Detalle de los pagos realizados para esta cuota"})]}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-medium text-sm text-muted-foreground",children:"Historial de Pagos"}),r.length>0?(0,t.jsx)("div",{className:"space-y-3",children:r.map((e,s)=>(0,t.jsx)(g.Zp,{className:"border-l-4 ".concat(e.status===O.COMPLETED?"border-l-green-500":e.status===O.FAILED?"border-l-red-500":e.status===O.PENDING?"border-l-yellow-500":"border-l-gray-500"),children:(0,t.jsx)(g.Wu,{className:"p-4",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 rounded-full flex items-center justify-center ".concat(e.status===O.COMPLETED?"bg-green-100 dark:bg-green-900/30":e.status===O.FAILED?"bg-red-100 dark:bg-red-900/30":e.status===O.PENDING?"bg-yellow-100 dark:bg-yellow-900/30":"bg-gray-100 dark:bg-gray-900/30"),children:(e=>{switch(e){case O.COMPLETED:return(0,t.jsx)(T.A,{className:"h-4 w-4 text-green-600"});case O.FAILED:return(0,t.jsx)(B.A,{className:"h-4 w-4 text-red-600"});case O.PENDING:return(0,t.jsx)(L.A,{className:"h-4 w-4 text-yellow-600"});default:return(0,t.jsx)(G.A,{className:"h-4 w-4 text-gray-600"})}})(e.status)}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium text-sm",children:["Pago #",s+1]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,t.jsx)(S.A,{className:"h-3 w-3"}),new Date(e.createdAt).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)(A.E,{className:(e=>{switch(e){case O.COMPLETED:return"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300";case O.FAILED:return"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300";case O.PENDING:return"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300";default:return"bg-gray-100 dark:bg-gray-900/20 text-gray-800 dark:text-gray-300"}})(e.status),children:(e=>{switch(e){case O.COMPLETED:return"Aprobado";case O.FAILED:return"Rechazado";case O.PENDING:return"Pendiente";default:return e}})(e.status)})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Monto"}),(0,t.jsx)("p",{className:"font-semibold",children:j(e.amount,e.currency)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"M\xe9todo"}),(0,t.jsx)("p",{className:"font-medium",children:e.method})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Nro. Operaci\xf3n"}),(0,t.jsx)("p",{className:"font-mono text-xs",children:e.reference||"No especificado"})]})]}),c&&e.status===O.PENDING&&(0,t.jsxs)("div",{className:"flex gap-2 pt-2 border-t",children:[(0,t.jsxs)(l.$,{size:"sm",onClick:()=>u(e.id),disabled:i===e.id,className:"flex-1 bg-green-600 hover:bg-green-700",children:[(0,t.jsx)(T.A,{className:"h-4 w-4 mr-2"}),i===e.id?"Aprobando...":"Aprobar"]}),(0,t.jsxs)(l.$,{size:"sm",variant:"destructive",onClick:()=>h(e.id),disabled:i===e.id,className:"flex-1",children:[(0,t.jsx)(B.A,{className:"h-4 w-4 mr-2"}),i===e.id?"Rechazando...":"Rechazar"]})]})]})})},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(D.A,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),(0,t.jsx)("p",{className:"text-sm",children:"No hay pagos registrados para esta cuota"})]})]})})]})})},$=e=>{let{company:s}=e,[a,r]=(0,o.useState)({open:!1,payments:[],description:""}),n=e=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:2}).format(e),c=s.contract.filter(e=>e.isActive),i=c.reduce((e,s)=>e+s.monthlyPayment,0),d=c.flatMap(e=>e.installments||[]);return(0,t.jsxs)("div",{className:"w-full",children:[(0,t.jsxs)(P.tU,{defaultValue:"general",className:"w-full",children:[(0,t.jsxs)(P.j7,{className:"grid w-full grid-cols-3",children:[(0,t.jsx)(P.Xi,{value:"general",children:"Informaci\xf3n General"}),(0,t.jsx)(P.Xi,{value:"payments",children:"Informaci\xf3n de Pagos"}),(0,t.jsx)(P.Xi,{value:"installments",children:"Cuotas"})]}),(0,t.jsx)(P.av,{value:"general",children:(0,t.jsxs)(g.Zp,{children:[(0,t.jsx)(g.aR,{children:(0,t.jsxs)(g.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(E.A,{className:"h-5 w-5 text-muted-foreground"}),"Detalles de la Empresa"]})}),(0,t.jsx)(g.Wu,{className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Datos Empresariales"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(E.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Raz\xf3n Social:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:s.businessName})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(E.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Nombre Comercial:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:s.tradeName})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(D.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"RUC:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground font-mono",children:s.ruc})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Direcci\xf3n:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:s.address})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Informaci\xf3n de Contacto"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Contacto Principal:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:s.contactName})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Tel\xe9fono:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:s.contactPhone})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(M.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Email:"}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:s.contactEmail})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(L.A,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Estado:"}),(0,t.jsx)("div",{className:"mt-1",children:(0,t.jsx)(A.E,{variant:s.isActive?"default":"destructive",children:s.isActive?"Activo":"Inactivo"})})]})]})]})]})]})})]})}),(0,t.jsx)(P.av,{value:"payments",children:(0,t.jsxs)(g.Zp,{children:[(0,t.jsx)(g.aR,{children:(0,t.jsxs)(g.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(z.A,{className:"h-5 w-5 text-muted-foreground"}),"Informaci\xf3n de Pagos"]})}),(0,t.jsxs)(g.Wu,{className:"space-y-6",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-1 gap-4",children:(0,t.jsxs)("div",{className:"p-4 bg-muted rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-5 w-5 text-muted-foreground"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"Ingresos Mensuales"})]}),(0,t.jsx)("div",{className:"text-2xl font-bold text-foreground mt-2",children:n(i)})]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Detalle del Colaborador Asignado"}),c.length>0?(0,t.jsx)("div",{className:"space-y-3",children:c.map(e=>(0,t.jsx)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 bg-muted rounded-full flex items-center justify-center",children:(0,t.jsx)(f.A,{className:"h-5 w-5 text-muted-foreground"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.user.fullName}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:"Colaborador asignado"})]})]})},e.id))}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(z.A,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),(0,t.jsx)("div",{className:"text-sm italic",children:"No hay informaci\xf3n del colaborador asignado."})]})]})]})]})}),(0,t.jsx)(P.av,{value:"installments",children:(0,t.jsxs)(g.Zp,{children:[(0,t.jsx)(g.aR,{children:(0,t.jsxs)(g.ZB,{className:"flex items-center gap-2 text-lg",children:[(0,t.jsx)(S.A,{className:"h-5 w-5 text-muted-foreground"}),"Cuotas de Pago"]})}),(0,t.jsx)(g.Wu,{className:"space-y-6",children:d&&d.length>0?(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground",children:"Detalle de Cuotas"}),d.map((e,s)=>{var a,c;let i=(null==(a=e.payments)?void 0:a.reduce((e,s)=>s.status===O.COMPLETED?e+(s.amount||0):e,0))||0,d=i>=e.amount,o=e.payments&&e.payments.length>0,m=(null==(c=e.payments)?void 0:c.some(e=>e.status===O.PENDING))||!1;return(0,t.jsx)(g.Zp,{className:"".concat(d?"border-l-4 border-l-primary":"border-l-4 border-l-muted-foreground"),children:(0,t.jsx)(g.Wu,{children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold ".concat(d?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:s+1}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"font-medium truncate",children:e.description}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,t.jsxs)("span",{className:"block sm:inline",children:["Vence: ",(e=>{try{return(0,N.GP)(new Date(e),"dd 'de' MMMM 'de' yyyy",{locale:v.es})}catch(e){return"Fecha inv\xe1lida"}})(e.dueDate)]}),(0,t.jsx)("span",{className:"hidden sm:inline",children:" • "}),(0,t.jsx)("span",{className:"block sm:inline",children:n(e.amount)})]}),d&&(0,t.jsxs)("div",{className:"text-sm text-primary font-medium",children:["Pagado: ",n(i)]}),m&&!d&&(0,t.jsx)("div",{className:"text-sm text-yellow-600 font-medium",children:"En verificaci\xf3n"})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[(0,t.jsx)(A.E,{variant:d?"default":m?"outline":"secondary",className:"self-start sm:self-center ".concat(m&&!d?"border-yellow-500 text-yellow-600":""),children:d?"Pagado":m?"En Verificaci\xf3n":"Pendiente"}),(0,t.jsxs)(l.$,{size:"sm",variant:"outline",disabled:!o,onClick:()=>{r({open:!0,payments:e.payments||[],description:e.description})},className:"gap-2 w-full sm:w-auto",children:[(0,t.jsx)(R.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sm:inline",children:"Ver Pagos"})]})]})]})})},e.id)})]})}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(S.A,{className:"h-12 w-12 mx-auto text-muted-foreground/50 mb-4"}),(0,t.jsx)("div",{className:"text-sm italic",children:"No hay cuotas registradas para esta empresa"})]})})]})})]}),(0,t.jsx)(J,{open:a.open,onOpenChange:e=>r(s=>({...s,open:e})),payments:a.payments,installmentDescription:a.description,canManagePayments:!0})]})},Z=e=>{let{data:s,isLoading:a=!1,onEdit:r,serverPagination:n=!1,paginationMeta:c,onPageChange:i,onPageSizeChange:d}=e,[m,u]=(0,o.useState)(null),[h,j]=(0,o.useState)(null),g=(0,x.km)(),p=h&&s.find(e=>e.id===h)||null,P=async()=>{if(m)try{await g.mutateAsync(m.id),u(null)}catch(e){console.error("Error al eliminar empresa:",e)}},D=(0,o.useMemo)(()=>[{accessorKey:"businessName",header:"Empresa",cell:e=>{let{row:s}=e;return(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:s.original.businessName}),(0,t.jsx)("div",{className:"text-xs text-muted-foreground",children:s.original.tradeName}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:["RUC: ",s.original.ruc]})]})}},{accessorKey:"contactName",header:"Contacto",cell:e=>{let{row:s}=e;return(0,t.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,t.jsx)("div",{className:"font-medium",children:s.original.contactName}),(0,t.jsx)("div",{className:"text-muted-foreground",children:s.original.contactPhone}),(0,t.jsx)("div",{className:"text-muted-foreground truncate max-w-[150px]",children:s.original.contactEmail})]})}},{accessorKey:"address",header:"Direcci\xf3n",cell:e=>{let{row:s}=e;return(0,t.jsx)("div",{className:"text-sm truncate max-w-[200px]",children:s.original.address})}},{accessorKey:"contract",header:"Colaboradores",cell:e=>{let{row:s}=e;return(e=>{if(0===e.length)return(0,t.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"Sin colaborador asignado"});let s=e.filter(e=>e.isActive);return(0,t.jsxs)("div",{className:"space-y-1",children:[s.slice(0,2).map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,t.jsx)(f.A,{className:"h-3 w-3 text-green-500"}),(0,t.jsx)("span",{className:"font-medium truncate max-w-[120px]",children:e.user.fullName})]},e.id)),s.length>2&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["+",s.length-2," m\xe1s"]})]})})(s.original.contract)}},{accessorKey:"revenue",header:"Ingresos",cell:e=>{let{row:s}=e,a=s.original.contract.filter(e=>e.isActive).reduce((e,s)=>e+s.monthlyPayment,0);return(0,t.jsx)("div",{className:"text-sm",children:a>0?(0,t.jsx)(A.E,{variant:"secondary",className:"font-mono",children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN",minimumFractionDigits:0}).format(a)}):(0,t.jsx)("span",{className:"text-muted-foreground italic",children:"S/ 0.00"})})}},{accessorKey:"isActive",header:"Estado",cell:e=>{let{row:s}=e;return(e=>(0,t.jsx)(A.E,{variant:e?"default":"destructive",children:e?"Activo":"Inactivo"}))(s.original.isActive)}},{accessorKey:"createdAt",header:"Fecha Registro",cell:e=>{let{row:s}=e;var a=s.original.createdAt;try{return(0,N.GP)(new Date(a),"dd/MM/yyyy",{locale:v.es})}catch(e){return"Fecha inv\xe1lida"}}},{id:"actions",header:"Acciones",cell:e=>{let{row:s}=e;return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(l.$,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),null==r||r(s.original)},className:"h-8 px-2",children:(0,t.jsx)(b.A,{className:"h-4 w-4"})}),(0,t.jsx)(l.$,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),u(s.original)},className:"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(y.A,{className:"h-4 w-4"})})]})}}],[r]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(C.b,{data:s,columns:D,isLoading:a,title:"Empresas",icon:E.A,noDataMessage:"No se encontraron empresas registradas",enablePagination:!0,enableSorting:!0,pageSize:10,selectedItem:p,detailComponent:e=>(0,t.jsx)($,{company:e}),detailTitle:e=>e.businessName,getItemId:e=>e.id,onRowClick:e=>{e?j(h===e.id?null:e.id):j(null)},serverPagination:n,paginationMeta:c,onPageChange:i,onPageSizeChange:d}),(0,t.jsx)(w.Lt,{open:!!m,onOpenChange:()=>u(null),children:(0,t.jsxs)(w.EO,{children:[(0,t.jsxs)(w.wd,{children:[(0,t.jsx)(w.r7,{children:"\xbfEliminar Empresa?"}),(0,t.jsxs)(w.$v,{children:["\xbfEst\xe1s seguro de que deseas eliminar la empresa"," ",(0,t.jsx)("span",{className:"font-semibold",children:null==m?void 0:m.businessName}),"? Esta acci\xf3n no se puede deshacer y eliminar\xe1 todas las relaciones asociadas."]})]}),(0,t.jsxs)(w.ck,{children:[(0,t.jsx)(w.Zr,{children:"Cancelar"}),(0,t.jsx)(w.Rx,{onClick:P,className:"bg-red-600 hover:bg-red-700 text-white",disabled:g.isPending,children:g.isPending?"Eliminando...":"Eliminar"})]})]})})]})};var U=a(62177),Y=a(90221),_=a(73162),K=a(17759),V=a(47262),W=a(88539),X=a(57434),q=a(51154),H=a(43126);let Q=_.Ik({ruc:_.Yj().min(1,"El RUC es obligatorio").length(11,"El RUC debe tener exactamente 11 d\xedgitos").regex(/^\d+$/,"El RUC debe contener solo n\xfameros"),businessName:_.Yj().min(1,"La raz\xf3n social es obligatoria").min(3,"La raz\xf3n social debe tener al menos 3 caracteres").max(200,"La raz\xf3n social no puede exceder 200 caracteres"),tradeName:_.Yj().min(1,"El nombre comercial es obligatorio").min(2,"El nombre comercial debe tener al menos 2 caracteres").max(150,"El nombre comercial no puede exceder 150 caracteres"),address:_.Yj().min(1,"La direcci\xf3n es obligatoria").min(10,"La direcci\xf3n debe tener al menos 10 caracteres").max(300,"La direcci\xf3n no puede exceder 300 caracteres"),contactName:_.Yj().min(1,"El nombre de contacto es obligatorio").min(2,"El nombre de contacto debe tener al menos 2 caracteres").max(100,"El nombre de contacto no puede exceder 100 caracteres"),contactPhone:_.Yj().min(1,"El tel\xe9fono de contacto es obligatorio").min(9,"El tel\xe9fono debe tener al menos 9 caracteres").max(20,"El tel\xe9fono no puede exceder 20 caracteres"),contactEmail:_.Yj().min(1,"El email de contacto es obligatorio").email("Email inv\xe1lido").max(150,"El email no puede exceder 150 caracteres"),isActive:_.zM(),userId:_.Yj().min(1,"Debe seleccionar un colaborador interno"),monthlyPayment:_.ai().min(1,"El pago mensual debe ser mayor a 0").max(999999,"El pago mensual no puede exceder S/ 999,999"),paymentDate:_.p6()});function ee(e){let{open:s,onOpenChange:a,onCompanySaved:r,company:n=null,mode:c="create"}=e,i=(0,x.Tm)(),d=(0,x.Mv)(),[m,u]=(0,o.useState)(!1),{options:j,refetch:g}=(0,x.oY)(),p=j.map(e=>({value:e.value,label:e.label})),N=(0,U.mN)({resolver:(0,Y.u)(Q),defaultValues:{ruc:"",businessName:"",tradeName:"",address:"",contactName:"",contactPhone:"",contactEmail:"",isActive:!0,userId:"",monthlyPayment:0,paymentDate:new Date}});(0,o.useEffect)(()=>{if("edit"===c&&n&&s){var e;let s=null==(e=n.contract)?void 0:e.find(e=>e.isActive);N.reset({ruc:n.ruc,businessName:n.businessName,tradeName:n.tradeName,address:n.address,contactName:n.contactName,contactPhone:n.contactPhone,contactEmail:n.contactEmail,isActive:n.isActive,userId:(null==s?void 0:s.user.id)||"",monthlyPayment:(null==s?void 0:s.monthlyPayment)||0,paymentDate:s?new Date(s.paymentDate):new Date})}else"create"===c&&s&&N.reset({ruc:"",businessName:"",tradeName:"",address:"",contactName:"",contactPhone:"",contactEmail:"",isActive:!0,userId:"",monthlyPayment:0,paymentDate:new Date});s&&g()},[c,n,s,N,g]);let v=async e=>{if(!m){u(!0);try{if("edit"===c&&n){let s={ruc:e.ruc,businessName:e.businessName,tradeName:e.tradeName,address:e.address,contactName:e.contactName,contactPhone:e.contactPhone,contactEmail:e.contactEmail,isActive:e.isActive,userRelation:{userId:e.userId,monthlyPayment:e.monthlyPayment,paymentDate:e.paymentDate.toISOString(),isActive:!0}};await d.mutateAsync({id:n.id,data:s})}else{let s={ruc:e.ruc,businessName:e.businessName,tradeName:e.tradeName,address:e.address,contactName:e.contactName,contactPhone:e.contactPhone,contactEmail:e.contactEmail,isActive:e.isActive,userRelation:{userId:e.userId,monthlyPayment:e.monthlyPayment,paymentDate:e.paymentDate.toISOString(),isActive:!0}};await i.mutateAsync(s)}N.reset(),a(!1),r()}catch(e){console.error("Error en operaci\xf3n de la empresa:",e)}finally{u(!1)}}},b=i.isPending||d.isPending||m;return(0,t.jsx)(F.lG,{open:s,onOpenChange:a,children:(0,t.jsxs)(F.Cf,{className:"sm:max-w-[900px] max-w-[95vw] max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,t.jsxs)(F.c7,{className:"border-b pb-4",children:[(0,t.jsxs)(F.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"h-5 w-5"}),"edit"===c?"Editar Empresa":"Crear Nueva Empresa"]}),(0,t.jsx)(F.rr,{children:"edit"===c?"Modifica la informaci\xf3n de la empresa y su relaci\xf3n con el colaborador.":"Completa la informaci\xf3n para crear una nueva empresa y asignar un colaborador responsable."})]}),(0,t.jsx)(K.lV,{...N,children:(0,t.jsxs)("form",{onSubmit:N.handleSubmit(v),className:"space-y-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"h-5 w-5"}),"Informaci\xf3n de la Empresa"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(K.zB,{control:N.control,name:"ruc",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"RUC *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"20123456789",...s})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:N.control,name:"businessName",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Raz\xf3n Social *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Empresa Ejemplo S.A.C.",...s})}),(0,t.jsx)(K.C5,{})]})}})]}),(0,t.jsx)(K.zB,{control:N.control,name:"tradeName",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Nombre Comercial *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Empresa Ejemplo",...s})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:N.control,name:"address",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Direcci\xf3n *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(W.T,{placeholder:"Av. Principal 123, Lima, Per\xfa",...s,rows:2})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(K.zB,{control:N.control,name:"contactName",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Nombre de Contacto *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"Juan P\xe9rez",...s})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:N.control,name:"contactPhone",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Tel\xe9fono de Contacto *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{placeholder:"+51999999999",...s})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:N.control,name:"contactEmail",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Email de Contacto *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{type:"email",placeholder:"contacto@empresa.com",...s})}),(0,t.jsx)(K.C5,{})]})}})]}),(0,t.jsx)(K.zB,{control:N.control,name:"isActive",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,t.jsx)(K.MJ,{children:(0,t.jsx)(V.S,{checked:s.value,onCheckedChange:s.onChange})}),(0,t.jsx)("div",{className:"space-y-1 leading-none",children:(0,t.jsx)(K.lR,{children:"Empresa activa"})})]})}})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-5 w-5"}),"Asignaci\xf3n de Colaborador"]}),(0,t.jsx)(K.zB,{control:N.control,name:"userId",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsx)(K.lR,{children:"Colaborador Interno *"}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(H.Zi,{options:p,value:s.value,onValueChange:s.onChange,placeholder:"Seleccionar colaborador...",searchPlaceholder:"Buscar colaborador...",emptyMessage:"No se encontraron colaboradores"})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,t.jsx)(X.A,{className:"h-5 w-5"}),"Contrato"]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(K.zB,{control:N.control,name:"monthlyPayment",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsxs)(K.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.A,{className:"h-4 w-4"}),"Pago Mensual a CECAGEM (S/) *"]}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(h.p,{type:"number",placeholder:"1500",...s,onChange:e=>s.onChange(Number(e.target.value))})}),(0,t.jsx)(K.C5,{})]})}}),(0,t.jsx)(K.zB,{control:N.control,name:"paymentDate",render:e=>{let{field:s}=e;return(0,t.jsxs)(K.eI,{children:[(0,t.jsxs)(K.lR,{className:"flex items-center gap-2",children:[(0,t.jsx)(S.A,{className:"h-4 w-4"}),"Fecha de Pago Mensual *"]}),(0,t.jsx)(K.MJ,{children:(0,t.jsx)(H.J3,{value:s.value,onChange:s.onChange,placeholder:"Seleccionar fecha"})}),(0,t.jsx)(K.C5,{})]})}})]})]})]}),(0,t.jsxs)(F.Es,{className:"gap-2 border-t pt-4",children:[(0,t.jsx)(l.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:b,children:"Cancelar"}),(0,t.jsxs)(l.$,{type:"submit",disabled:b,className:"text-white",children:[b&&(0,t.jsx)(q.A,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===c?"Actualizar Empresa":"Crear Empresa"]})]})]})})]})})}var es=a(33109),ea=a(17580),et=a(44922);let er=e=>{let{data:s,isLoading:a=!1}=e;return(0,t.jsxs)(et.M,{columns:3,children:[(0,t.jsx)(et.h,{title:"Total de Empresas",value:(null==s?void 0:s.totalCompanies)||0,subtitle:"".concat((null==s?void 0:s.thisMonthCompanies)||0," nuevas este mes"),icon:E.A,loading:a}),(0,t.jsx)(et.h,{title:"Empresas Activas",value:(null==s?void 0:s.activeCompanies)||0,subtitle:"".concat(s?Math.round(s.activeCompanies/(s.totalCompanies||1)*100):0,"% del total"),icon:es.A,variant:"success",loading:a}),(0,t.jsx)(et.h,{title:"Empresas Inactivas",value:(null==s?void 0:s.inactiveCompanies)||0,subtitle:"".concat(s?Math.round(s.inactiveCompanies/(s.totalCompanies||1)*100):0,"% del total"),icon:ea.A,variant:"error",loading:a})]})};function en(){let[e,s]=(0,o.useState)({page:1,limit:10}),[a,r]=(0,o.useState)(!1),[n,c]=(0,o.useState)(!1),[i,d]=(0,o.useState)(null),{data:u,isLoading:h,error:j,refetch:g}=(0,x.Rr)(e),{data:N,isLoading:v}=(0,x.uD)(),f=(null==u?void 0:u.data)||[],b=null==u?void 0:u.pagination,y=(0,o.useCallback)(e=>{s(s=>({...s,page:e}))},[]),E=(0,o.useCallback)(e=>{s(s=>({...s,limit:e,page:1}))},[]),C=(0,o.useCallback)(e=>{s(s=>({...s,...e,page:1}))},[]),w=(0,o.useCallback)(()=>{s({page:1,limit:10})},[]),A=(0,o.useCallback)(()=>{d(null),r(!0)},[]),P=(0,o.useCallback)(e=>{d(e),c(!0)},[]),D=(0,o.useCallback)(e=>{console.log("Eliminar empresa:",e)},[]),k=(0,o.useCallback)(()=>{g()},[g]),I=(0,o.useCallback)(()=>{r(!1),d(null)},[]),M=(0,o.useCallback)(()=>{c(!1),d(null)},[]);return j?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-destructive mb-2",children:"Error al cargar las empresas"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:j.message||"Ha ocurrido un error inesperado"}),(0,t.jsx)(l.$,{onClick:()=>g(),variant:"outline",children:"Intentar nuevamente"})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Clientes Contables"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gestiona las empresas y sus relaciones con colaboradores internos"})]}),(0,t.jsxs)(l.$,{onClick:A,className:"text-white",children:[(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Nueva Empresa"]})]}),(0,t.jsx)(er,{data:N,isLoading:v}),(0,t.jsx)(p,{filters:e,onFiltersChange:C,onClearFilters:w}),(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)(Z,{data:f,isLoading:h,onEdit:P,onDelete:D,serverPagination:!0,paginationMeta:b,onPageChange:y,onPageSizeChange:E})}),(0,t.jsx)(ee,{open:a,onOpenChange:I,onCompanySaved:k,mode:"create"}),(0,t.jsx)(ee,{open:n,onOpenChange:M,onCompanySaved:k,company:i,mode:"edit"})]})}function el(){return(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsxs)("header",{className:"bg-background/60 backdrop-blur-md sticky top-0 z-50 flex h-12 shrink-0 items-center gap-2 border-b px-4",children:[(0,t.jsx)(i.SidebarTrigger,{className:"-ml-1"}),(0,t.jsx)(c.Separator,{orientation:"vertical",className:"mr-2 h-4"}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(n.Qp,{children:(0,t.jsx)(n.AB,{children:(0,t.jsx)(n.J5,{children:(0,t.jsx)(n.tJ,{children:"Clientes Contables"})})})})}),(0,t.jsxs)("div",{className:"ml-auto mr-4",children:[(0,t.jsx)(r.default,{}),(0,t.jsx)(l.$,{variant:"ghost",size:"icon","aria-label":"Notificaciones",className:"mr-2",children:(0,t.jsx)(d.A,{className:"h-5 w-5"})})]})]}),(0,t.jsx)("div",{className:"flex flex-1 flex-col gap-6 p-4 md:p-6",children:(0,t.jsx)(en,{})})]})}a(43380)},57385:(e,s,a)=>{Promise.resolve().then(a.bind(a,33240))},88539:(e,s,a)=>{"use strict";a.d(s,{T:()=>n});var t=a(95155);a(12115);var r=a(59434);function n(e){let{className:s,...a}=e;return(0,t.jsx)("textarea",{className:(0,r.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-xs placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}}},e=>{e.O(0,[9558,5041,8859,5089,221,8034,2764,5838,7632,2896,3240,4348,1339,8403,8889,3794,4811,8441,5964,7358],()=>e(e.s=57385)),_N_E=e.O()}]);