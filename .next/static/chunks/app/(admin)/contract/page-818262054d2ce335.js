(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1298],{1965:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ek});var l=a(95155),r=a(91165),t=a(19018),n=a(30285),i=a(22346),c=a(3501),d=a(23861),o=a(12115),m=a(84616),x=a(54165),u=a(19853),h=a(47924),j=a(62523),p=a(59409),v=a(66695),g=a(78534);let b=e=>{var s;let{filters:a,onFiltersChange:r,onClearFilters:t,isLoading:i=!1}=e,{data:c}=(0,g.A$)({isActive:!0,limit:100}),d=(e,s)=>{r({...a,[e]:s})},o=Object.values(a).some(e=>void 0!==e&&""!==e&&null!==e&&"all"!==e);return(0,l.jsx)(v.Zp,{children:(0,l.jsx)(v.Wu,{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(h.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,l.jsx)(j.p,{placeholder:"Buscar contratos...",value:a.search||"",onChange:e=>d("search",e.target.value),className:"pl-10",disabled:i})]})}),(0,l.jsx)("div",{children:(0,l.jsxs)(p.l6,{value:a.serviceId||"all",onValueChange:e=>{"all"===e?d("serviceId",void 0):d("serviceId",e)},disabled:i,children:[(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Todos los servicios"})}),(0,l.jsxs)(p.gC,{children:[(0,l.jsx)(p.eb,{value:"all",children:"Todos los servicios"}),null==c||null==(s=c.data)?void 0:s.map(e=>(0,l.jsx)(p.eb,{value:e.id,children:e.name},e.id))]})]})}),(0,l.jsx)("div",{children:(0,l.jsxs)(p.l6,{value:a.sortBy||"createdAt",onValueChange:e=>d("sortBy",e),disabled:i,children:[(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Ordenar por"})}),(0,l.jsxs)(p.gC,{children:[(0,l.jsx)(p.eb,{value:"createdAt",children:"Fecha de creaci\xf3n"}),(0,l.jsx)(p.eb,{value:"updatedAt",children:"Fecha de actualizaci\xf3n"}),(0,l.jsx)(p.eb,{value:"startDate",children:"Fecha de inicio"}),(0,l.jsx)(p.eb,{value:"endDate",children:"Fecha de fin"})]})]})}),(0,l.jsx)("div",{children:o&&(0,l.jsx)(n.$,{variant:"outline",onClick:t,disabled:i,className:"w-full",children:"Limpiar Filtros"})})]})})})};var f=a(57434),N=a(88889),y=a(26126),C=a(62525);function w(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"PEN",a={PEN:{symbol:"S/",locale:"es-PE"},USD:{symbol:"$",locale:"en-US"}}[s];return"".concat(a.symbol," ").concat(e.toLocaleString(a.locale,{minimumFractionDigits:2,maximumFractionDigits:2}))}let I=function(){let{onDelete:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{accessorKey:"name",header:"Nombre del Proyecto",cell:e=>{let{row:s}=e,a=s.original;return(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("div",{className:"font-medium",children:a.name}),(0,l.jsx)("div",{className:"text-xs text-muted-foreground",children:a.university}),a.career&&(0,l.jsx)("div",{className:"text-xs text-muted-foreground",children:a.career})]})}},{accessorKey:"costTotal",header:"Costo Total",cell:e=>{let{row:s}=e,a=s.original;return(0,l.jsx)("div",{children:(0,l.jsx)("div",{className:"font-medium",children:w(a.costTotal,a.currency)})})}},{accessorKey:"overallProgress",header:"Progreso General",cell:e=>{let{row:s}=e,a=s.getValue("overallProgress");return(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"text-sm font-medium",children:[a,"%"]}),(0,l.jsx)("div",{className:"w-full bg-secondary rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:"".concat(a,"%")}})})]})}},{accessorKey:"deliverablesPercentage",header:"Entregables",cell:e=>{let{row:s}=e,a=s.getValue("deliverablesPercentage");return(0,l.jsxs)(y.E,{variant:100===a?"default":"secondary",children:[a,"%"]})}},{accessorKey:"paymentPercentage",header:"Pagos",cell:e=>{let{row:s}=e,a=s.getValue("paymentPercentage");return(0,l.jsxs)(y.E,{variant:100===a?"default":"destructive",children:[a,"%"]})}},{accessorKey:"startDate",header:"Fecha Inicio",cell:e=>{let{row:s}=e,a=new Date(s.getValue("startDate"));return(0,l.jsx)("div",{className:"text-sm",children:a.toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"})})}},{accessorKey:"endDate",header:"Fecha Fin",cell:e=>{let{row:s}=e,a=new Date(s.getValue("endDate"));return(0,l.jsx)("div",{className:"text-sm",children:a.toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"})})}},{id:"actions",header:"Acciones",cell:s=>{let{row:a}=s,r=a.original;return(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>null==e?void 0:e(r.id),className:"h-8 px-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,l.jsx)(C.A,{className:"h-4 w-4"})})})}}]};var E=a(17313),A=a(92657),S=a(29869),P=a(81497),D=a(40646),k=a(54416),R=a(26715),T=a(5041),L=a(81630),O=a(87481);let B={all:["payments"],lists:()=>[...B.all,"list"],byInstallment:e=>[...B.lists(),"installment",e]};var M=a(45546),V=a(62177),z=a(90221),F=a(73162),q=a(17759),Z=a(88539),$=a(1243);let K=F.Ik({notes:F.Yj().min(10,"La nota debe tener al menos 10 caracteres").max(500,"La nota no puede exceder 500 caracteres")}),U=e=>{let{open:s,onOpenChange:a,onConfirm:r,deliverableName:t,isLoading:i=!1}=e,c=(0,V.mN)({resolver:(0,z.u)(K),defaultValues:{notes:""}});return(0,l.jsx)(x.lG,{open:s,onOpenChange:a,children:(0,l.jsxs)(x.Cf,{className:"sm:max-w-md",children:[(0,l.jsxs)(x.c7,{children:[(0,l.jsxs)(x.L3,{className:"flex items-center gap-2",children:[(0,l.jsx)($.A,{className:"h-5 w-5 text-destructive"}),"Rechazar Entregable"]}),(0,l.jsxs)(x.rr,{children:["Est\xe1s a punto de rechazar el entregable ",(0,l.jsx)("strong",{children:t}),". Por favor, proporciona una nota explicando el motivo del rechazo."]})]}),(0,l.jsx)(q.lV,{...c,children:(0,l.jsxs)("form",{onSubmit:c.handleSubmit(e=>{r(e.notes),c.reset()}),className:"space-y-4",children:[(0,l.jsx)(q.zB,{control:c.control,name:"notes",render:e=>{var s;let{field:a}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsxs)(q.lR,{children:["Motivo del rechazo ",(0,l.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(Z.T,{placeholder:"Describe detalladamente por qu\xe9 se rechaza este entregable...",className:"min-h-[100px] resize-none",...a})}),(0,l.jsx)(q.C5,{}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground",children:[(null==(s=a.value)?void 0:s.length)||0,"/500 caracteres"]})]})}}),(0,l.jsxs)(x.Es,{className:"gap-2",children:[(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>{c.reset(),a(!1)},disabled:i,children:"Cancelar"}),(0,l.jsx)(n.$,{type:"submit",variant:"destructive",disabled:i,children:i?"Rechazando...":"Rechazar Entregable"})]})]})})]})})};var J=function(e){return e.CASH="CASH",e.BANK_TRANSFER="BANK_TRANSFER",e.CARD="CARD",e.YAPE="YAPE",e.PLIN="PLIN",e.OTHER="OTHER",e}({});let W=F.Ik({amount:F.ai().min(.01,"El monto debe ser mayor a 0"),currency:F.k5(["PEN","USD"],{message:"Selecciona una moneda v\xe1lida"}),method:F.fc(J,{message:"Selecciona un m\xe9todo de pago"}),reference:F.Yj().optional()}),Q={[J.CASH]:"Efectivo",[J.BANK_TRANSFER]:"Transferencia Bancaria",[J.CARD]:"Tarjeta",[J.YAPE]:"Yape",[J.PLIN]:"Plin",[J.OTHER]:"Otro"},Y=[{value:"PEN",label:"PEN - Soles"},{value:"USD",label:"USD - D\xf3lares"}];function _(e){let{open:s,onOpenChange:a,installmentId:r}=e,t=(()=>{let e=(0,R.useQueryClient)(),{showSuccess:s,showError:a}=(0,O.d)();return(0,T.useMutation)({mutationFn:e=>L.M.createPayment(e),onSuccess:async(a,l)=>(await e.invalidateQueries({queryKey:B.byInstallment(l.installmentId)}),await e.invalidateQueries({queryKey:B.all}),await e.invalidateQueries({queryKey:["contracts"]}),s("created",{title:"Pago enviado",description:"El pago ha sido enviado para verificaci\xf3n exitosamente"}),a),onError:e=>{a("error",{title:"Error al enviar pago",description:(null==e?void 0:e.message)||"No se pudo enviar el pago para verificaci\xf3n"})}})})(),i=(0,V.mN)({resolver:(0,z.u)(W),defaultValues:{amount:0,currency:"PEN",method:J.BANK_TRANSFER,reference:""}}),c=async e=>{if(!r)return void console.error("No se ha seleccionado una cuota");try{await t.mutateAsync({installmentId:r,...e}),a(!1),i.reset()}catch(e){console.error("Error al crear pago:",e)}},d=()=>{a(!1),i.reset()};return(0,l.jsx)(x.lG,{open:s,onOpenChange:d,children:(0,l.jsxs)(x.Cf,{className:"sm:max-w-[500px] max-h-[90vh] overflow-y-auto",children:[(0,l.jsxs)(x.c7,{children:[(0,l.jsx)(x.L3,{children:"Subir Pago"}),(0,l.jsx)(x.rr,{children:"Registra tu pago para esta cuota. La informaci\xf3n ser\xe1 verificada por el equipo administrativo."})]}),(0,l.jsx)(q.lV,{...i,children:(0,l.jsxs)("form",{onSubmit:i.handleSubmit(c),className:"space-y-4",children:[(0,l.jsx)(q.zB,{control:i.control,name:"amount",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Monto"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(j.p,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:e=>s.onChange(Number(e.target.value))})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:i.control,name:"currency",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Moneda"}),(0,l.jsxs)(p.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(q.MJ,{children:(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Selecciona una moneda"})})}),(0,l.jsx)(p.gC,{children:Y.map(e=>(0,l.jsx)(p.eb,{value:e.value,children:e.label},e.value))})]}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:i.control,name:"method",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"M\xe9todo de Pago"}),(0,l.jsxs)(p.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(q.MJ,{children:(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Selecciona un m\xe9todo"})})}),(0,l.jsx)(p.gC,{children:Object.entries(Q).map(e=>{let[s,a]=e;return(0,l.jsx)(p.eb,{value:s,children:a},s)})})]}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:i.control,name:"reference",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"N\xfamero de Operaci\xf3n (Opcional)"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(j.p,{placeholder:"Ingresa el n\xfamero de operaci\xf3n",...s})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:d,disabled:t.isPending,children:"Cancelar"}),(0,l.jsx)(n.$,{type:"submit",disabled:t.isPending,children:t.isPending?"Enviando...":"Enviar Pago"})]})]})})]})})}let G=e=>{var s,a,r,t;let{contract:i}=e,[c,d]=(0,o.useState)("general"),[m,x]=(0,o.useState)({open:!1,payments:[],description:"",isCollaboratorPayment:!1}),[h,j]=(0,o.useState)({open:!1,contractId:"",deliverableId:"",deliverableName:""}),[p,g]=(0,o.useState)({open:!1,contractId:"",installmentId:""}),b=(0,u.k6)();(0,o.useEffect)(()=>{x({open:!1,payments:[],description:"",isCollaboratorPayment:!1}),j({open:!1,contractId:"",deliverableId:"",deliverableName:""}),g({open:!1,contractId:"",installmentId:""})},[i.id]);let f=e=>new Date(e).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",year:"numeric"}),N=function(e,s){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];x({open:!0,payments:e,description:s,isCollaboratorPayment:a})},C=async(e,s)=>{try{await b.mutateAsync({contractId:e,deliverableId:s,data:{isAproved:!0}})}catch(e){console.error("Error al verificar entregable:",e)}},I=async e=>{try{await b.mutateAsync({contractId:h.contractId,deliverableId:h.deliverableId,data:{isCompleted:!1,isAproved:!1,notes:e}}),j({open:!1,contractId:"",deliverableId:"",deliverableName:""})}catch(e){console.error("Error al rechazar entregable:",e)}},R=()=>{var e;return(null==(e=i.contractUsers)?void 0:e.some(e=>"COLLABORATOR_EXTERNAL"===e.user.role))||!1},T=e=>{g({open:!0,contractId:i.id,installmentId:e})};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)(E.tU,{value:c,onValueChange:d,className:"w-full",children:[(0,l.jsxs)(E.j7,{className:"grid w-full grid-cols-3",children:[(0,l.jsx)(E.Xi,{value:"general",children:"Informaci\xf3n General"}),(0,l.jsx)(E.Xi,{value:"payments",children:"Pagos y Cuotas"}),(0,l.jsx)(E.Xi,{value:"deliverables",children:"Entregables"})]}),(0,l.jsx)(E.av,{value:"general",className:"space-y-4",children:(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsx)(v.ZB,{children:"Informaci\xf3n del Contrato"})}),(0,l.jsxs)(v.Wu,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Nombre del Proyecto"}),(0,l.jsx)("p",{className:"text-base font-medium mt-1",children:i.name})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Universidad"}),(0,l.jsx)("p",{className:"text-base mt-1",children:i.university})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Carrera"}),(0,l.jsx)("p",{className:"text-base mt-1",children:i.career})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Costo Total"}),(0,l.jsx)("p",{className:"text-lg font-semibold text-primary mt-1",children:w(i.costTotal,i.currency)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Inicio"}),(0,l.jsx)("p",{className:"text-base mt-1",children:f(i.startDate)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Finalizaci\xf3n"}),(0,l.jsx)("p",{className:"text-base mt-1",children:f(i.endDate)})]})]}),(0,l.jsxs)("div",{className:"mt-6 pt-4 border-t space-y-4",children:[(0,l.jsx)("h4",{className:"font-semibold",children:"Progreso del Proyecto"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:"General"}),(0,l.jsxs)("span",{className:"text-sm font-semibold",children:[i.overallProgress,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-secondary rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(i.overallProgress,"%")}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:"Entregables"}),(0,l.jsxs)("span",{className:"text-sm font-semibold",children:[i.deliverablesPercentage,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-secondary rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(i.deliverablesPercentage,"%")}})})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,l.jsx)("span",{className:"text-sm font-medium",children:"Pagos"}),(0,l.jsxs)("span",{className:"text-sm font-semibold",children:[i.paymentPercentage,"%"]})]}),(0,l.jsx)("div",{className:"w-full bg-secondary rounded-full h-2",children:(0,l.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(i.paymentPercentage,"%")}})})]})]})]}),(0,l.jsxs)("div",{className:"mt-6 pt-4 border-t space-y-4",children:[(0,l.jsx)("h4",{className:"font-semibold",children:"Equipo del Proyecto"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Colaborador Asignado"}),(0,l.jsx)("div",{className:"space-y-2",children:i.contractUsers&&i.contractUsers.length>0?i.contractUsers.filter(e=>"COLLABORATOR_INTERNAL"===e.user.role||"COLLABORATOR_EXTERNAL"===e.user.role).map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[(0,l.jsx)("div",{className:"h-8 w-8 bg-primary/10 rounded-full flex items-center justify-center",children:(0,l.jsxs)("span",{className:"text-sm font-medium text-primary",children:[e.user.profile.firstName.charAt(0),e.user.profile.lastName.charAt(0)]})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("p",{className:"text-sm font-medium",children:[e.user.profile.firstName," ",e.user.profile.lastName]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"COLLABORATOR_INTERNAL"===e.user.role?"Colaborador Interno":"Colaborador Externo"})]}),(0,l.jsx)(y.E,{variant:"outline",className:"text-xs",children:e.user.profile.career})]},e.id)):(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"No hay colaboradores asignados"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Clientes de Investigaci\xf3n"}),(0,l.jsx)("div",{className:"space-y-2",children:i.contractUsers&&i.contractUsers.length>0?i.contractUsers.filter(e=>"CLIENT"===e.user.role).map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted/50 rounded-lg",children:[(0,l.jsx)("div",{className:"h-8 w-8 bg-blue-500/10 rounded-full flex items-center justify-center",children:(0,l.jsxs)("span",{className:"text-sm font-medium text-blue-600",children:[e.user.profile.firstName.charAt(0),e.user.profile.lastName.charAt(0)]})}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("p",{className:"text-sm font-medium",children:[e.user.profile.firstName," ",e.user.profile.lastName]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:e.user.profile.university})]}),(0,l.jsx)(y.E,{variant:"outline",className:"text-xs",children:"Cliente"})]},e.id)):(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"No hay clientes asignados"})})]})]})]}),i.observation&&(0,l.jsxs)("div",{className:"mt-6 pt-4 border-t",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-muted-foreground",children:"Observaciones"}),(0,l.jsx)("div",{className:"mt-2 p-3 bg-muted/50 rounded border-l-4 border-l-primary",children:(0,l.jsx)("p",{className:"text-sm",children:i.observation})})]})]})]})}),(0,l.jsxs)(E.av,{value:"payments",className:"space-y-4",children:[(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:"Cuotas de Pago del Contrato"}),(0,l.jsxs)(y.E,{variant:"secondary",children:[(null==(s=i.installments)?void 0:s.length)||0," cuotas"]})]})}),(0,l.jsx)(v.Wu,{children:i.installments&&0!==i.installments.length?(0,l.jsx)("div",{className:"space-y-3",children:i.installments.map((e,s)=>{var a,r;let t=(null==(a=e.payments)?void 0:a.reduce((e,s)=>"COMPLETED"===s.status?e+(s.amount||0):e,0))||0,c=t>=e.amount,d=e.payments&&e.payments.length>0,o=(null==(r=e.payments)?void 0:r.some(e=>"PENDING"===e.status))||!1;return(0,l.jsx)(v.Zp,{className:"".concat(c?"border-l-4 border-l-primary":"border-l-4 border-l-muted-foreground"),children:(0,l.jsx)(v.Wu,{children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold ".concat(c?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:s+1}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"font-medium truncate",children:e.description}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,l.jsxs)("span",{className:"block sm:inline",children:["Vence: ",f(e.dueDate)]}),(0,l.jsx)("span",{className:"hidden sm:inline",children:" • "}),(0,l.jsx)("span",{className:"block sm:inline",children:w(e.amount,i.currency)})]}),c&&(0,l.jsxs)("div",{className:"text-sm text-primary font-medium",children:["Pagado: ",w(t,i.currency)]}),o&&!c&&(0,l.jsx)("div",{className:"text-sm text-yellow-600 font-medium",children:"En verificaci\xf3n"})]})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[(0,l.jsx)(y.E,{variant:c?"default":o?"outline":"secondary",className:"self-start sm:self-center ".concat(o&&!c?"border-yellow-500 text-yellow-600":""),children:c?"Pagado":o?"En Verificaci\xf3n":"Pendiente"}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,l.jsxs)(n.$,{size:"sm",variant:"outline",disabled:!d,onClick:()=>N(e.payments||[],e.description,!1),className:"gap-2 w-full sm:w-auto text-xs",children:[(0,l.jsx)(A.A,{className:"h-3 w-3"}),(0,l.jsx)("span",{className:"sm:inline",children:"Ver Pagos"})]}),R()&&(0,l.jsxs)(n.$,{size:"sm",disabled:c,onClick:()=>T(e.id),className:"gap-2 w-full sm:w-auto",children:[(0,l.jsx)(S.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sm:inline",children:"Subir Pago"})]})]})]})]})})},e.id)})}):(0,l.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,l.jsx)("p",{children:"No hay cuotas de pago registradas para este contrato."})})})]}),R()&&(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:"Cuota de Pago al Colaborador"}),(0,l.jsxs)(y.E,{variant:"secondary",children:[(null==(a=i.contractUsers)?void 0:a.reduce((e,s)=>{var a;return e+((null==(a=s.installments)?void 0:a.length)||0)},0))||0," pagos"]})]})}),(0,l.jsx)(v.Wu,{children:(null==(r=i.contractUsers)?void 0:r.some(e=>e.installments&&e.installments.length>0))?(0,l.jsx)("div",{className:"space-y-4",children:i.contractUsers.filter(e=>"COLLABORATOR_EXTERNAL"===e.user.role&&e.installments&&e.installments.length>0).map(e=>{var s;return(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3 pb-2 border-b",children:[(0,l.jsx)("div",{className:"h-8 w-8 bg-blue-500/10 rounded-full flex items-center justify-center",children:(0,l.jsxs)("span",{className:"text-sm font-medium text-blue-600",children:[e.user.profile.firstName.charAt(0),e.user.profile.lastName.charAt(0)]})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{className:"text-sm font-medium",children:[e.user.profile.firstName," ",e.user.profile.lastName]}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:"Colaborador Externo"})]})]}),null==(s=e.installments)?void 0:s.map((s,a)=>{var r,t;let c=((null==(r=s.payments)?void 0:r.reduce((e,s)=>"COMPLETED"===s.status?e+(s.amount||0):e,0))||0)>=s.amount,d=s.payments&&s.payments.length>0,o=(null==(t=s.payments)?void 0:t.some(e=>"PENDING"===e.status))||!1;return(0,l.jsx)(v.Zp,{className:"ml-4 ".concat(c?"border-l-4 border-l-primary":"border-l-4 border-l-muted-foreground"),children:(0,l.jsx)(v.Wu,{children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("div",{className:"h-6 w-6 rounded-full flex items-center justify-center text-xs font-semibold ".concat(c?"bg-blue-500 text-white":"bg-muted text-muted-foreground"),children:a+1}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"font-medium truncate text-sm",children:s.description}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,l.jsxs)("span",{className:"block sm:inline",children:["Vence: ",f(s.dueDate)]}),(0,l.jsx)("span",{className:"hidden sm:inline",children:" • "}),(0,l.jsx)("span",{className:"block sm:inline",children:w(s.amount,i.currency)})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 sm:gap-3",children:[(0,l.jsx)(y.E,{variant:c?"default":o?"outline":"secondary",className:"self-start sm:self-center text-xs ".concat(c?"bg-blue-700":""," ").concat(o&&!c?"border-yellow-500 text-yellow-600":""),children:c?"Pagado":o?"En Verificaci\xf3n":"Pendiente"}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,l.jsxs)(n.$,{size:"sm",variant:"outline",disabled:!d,onClick:()=>N(s.payments||[],"Pago colaborador - ".concat(e.user.profile.firstName),!0),className:"gap-2 w-full sm:w-auto text-xs",children:[(0,l.jsx)(A.A,{className:"h-3 w-3"}),(0,l.jsx)("span",{className:"sm:inline",children:"Ver Pagos"})]}),(0,l.jsxs)(n.$,{size:"sm",disabled:c,onClick:()=>T(s.id),className:"gap-2 w-full sm:w-auto",children:[(0,l.jsx)(S.A,{className:"h-3 w-3"}),(0,l.jsx)("span",{className:"sm:inline",children:"Subir Pago"})]})]})]})]})})},s.id)})]},e.id)})}):(0,l.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,l.jsx)("p",{children:"No hay pagos de colaboradores registrados para este contrato."})})})]})]}),(0,l.jsx)(E.av,{value:"deliverables",className:"space-y-6",children:(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{children:"Entregables del Proyecto"}),(0,l.jsxs)(y.E,{variant:"secondary",className:"ml-auto",children:[(null==(t=i.contractDeliverables)?void 0:t.length)||0," entregables"]})]})}),(0,l.jsx)(v.Wu,{children:i.contractDeliverables&&0!==i.contractDeliverables.length?(0,l.jsx)("div",{className:"space-y-3",children:i.contractDeliverables.map((e,s)=>{var a,r;let t=e.isCompleted&&!e.isAproved,c=e.isAproved,d=e.isCompleted;return(0,l.jsx)(v.Zp,{className:"".concat(c?"border-l-4 border-l-green-500/50":d?"border-l-4 border-l-primary":"border-l-4 border-l-muted-foreground"),children:(0,l.jsx)(v.Wu,{children:(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsx)("div",{className:"h-8 w-8 rounded-full flex items-center justify-center text-sm font-semibold flex-shrink-0 ".concat(c?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300":d?"bg-primary text-primary-foreground":"bg-muted text-muted-foreground"),children:s+1}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("div",{className:"font-medium truncate",children:(null==(a=e.deliverable)?void 0:a.name)||"Entregable #".concat(s+1)}),(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:(null==(r=e.deliverable)?void 0:r.description)||"Sin descripci\xf3n"}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Asignado: ",f(e.assignedAt)]}),e.completedAt&&(0,l.jsxs)("div",{className:"text-sm text-primary font-medium",children:["Completado: ",f(e.completedAt)]}),e.notes&&(0,l.jsxs)("div",{className:"mt-2 p-2 rounded-md bg-primary/10 dark:bg-primary/20 border border-primary/20 dark:border-primary/30 flex items-start gap-2",children:[(0,l.jsx)(P.A,{className:"h-4 w-4 text-primary shrink-0"}),(0,l.jsxs)("div",{className:"text-xs break-words",children:[(0,l.jsx)("span",{className:"font-semibold text-primary",children:"Observaci\xf3n: "}),(0,l.jsx)("span",{className:"text-muted-foreground",children:e.notes})]})]})]})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)(y.E,{variant:d?"default":"secondary",className:"w-fit",children:d?"Completado":"En Progreso"}),c&&(0,l.jsx)(y.E,{variant:"default",className:"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 w-fit",children:"Aprobado"})]}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,l.jsxs)(n.$,{size:"sm",variant:t?"default":"outline",disabled:!t||b.isPending,onClick:()=>C(i.id,e.deliverableId),className:"gap-2 w-full sm:w-auto",children:[(0,l.jsx)(D.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sm:inline",children:b.isPending?"Verificando...":t?"Aprobar":c?"Aprobado":"No Disponible"})]}),(0,l.jsxs)(n.$,{size:"sm",variant:"destructive",disabled:!t||b.isPending,onClick:()=>{var a,l;return l=i.id,void j({open:!0,contractId:l,deliverableId:e.deliverableId,deliverableName:(null==(a=e.deliverable)?void 0:a.name)||"Entregable #".concat(s+1)})},className:"gap-2 w-full sm:w-auto",children:[(0,l.jsx)(k.A,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sm:inline",children:b.isPending?"Procesando...":"Rechazar"})]})]})]})]})})},e.id)})}):(0,l.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,l.jsx)("p",{children:"No hay entregables registrados para este contrato."})})})]})})]}),(0,l.jsx)(M.q,{open:m.open,onOpenChange:e=>x(s=>({...s,open:e})),payments:m.payments,installmentDescription:m.description,canManagePayments:!m.isCollaboratorPayment}),(0,l.jsx)(U,{open:h.open,onOpenChange:e=>j(s=>({...s,open:e})),onConfirm:I,deliverableName:h.deliverableName,isLoading:b.isPending}),(0,l.jsx)(_,{open:p.open,onOpenChange:e=>g(s=>({...s,open:e})),contractId:p.contractId,installmentId:p.installmentId})]})},X=e=>{let{data:s,isLoading:a=!1,onDelete:r,serverPagination:t=!1,paginationMeta:n,onPageChange:i,onPageSizeChange:c}=e,[d,m]=(0,o.useState)(null),x=d&&s.find(e=>e.id===d)||null,u=I({onDelete:r});return(0,l.jsx)(N.b,{data:s,columns:u,isLoading:a,title:"Contratos",icon:f.A,noDataMessage:"No se encontraron contratos registrados",enablePagination:!0,enableSorting:!0,pageSize:10,selectedItem:x,detailComponent:e=>(0,l.jsx)(G,{contract:e}),detailTitle:e=>e.name,getItemId:e=>e.id,onRowClick:e=>{e?m(d===e.id?null:e.id):m(null)},serverPagination:t,paginationMeta:n,onPageChange:i,onPageSizeChange:c})};var H=a(33109),ee=a(44922);let es=e=>{let{data:s,isLoading:a=!1}=e;return(0,l.jsxs)(ee.M,{columns:3,children:[(0,l.jsx)(ee.h,{title:"Total de Proyectos",value:(null==s?void 0:s.totalContracts)||0,subtitle:"".concat((null==s?void 0:s.thisMonthContracts)||0," nuevos este mes"),icon:f.A,loading:a}),(0,l.jsx)(ee.h,{title:"Proyectos Activos",value:(null==s?void 0:s.activeContracts)||0,subtitle:"".concat(s?Math.round(s.activeContracts/(s.totalContracts||1)*100):0,"% del total"),icon:H.A,variant:"success",loading:a}),(0,l.jsx)(ee.h,{title:"Proyectos Completados",value:(null==s?void 0:s.completedContracts)||0,subtitle:"".concat(s?Math.round(s.completedContracts/(s.totalContracts||1)*100):0,"% completados"),icon:D.A,variant:"default",loading:a})]})};var ea=a(90010);let el=e=>{let{open:s,onOpenChange:a,onConfirm:r,contractName:t,isLoading:n=!1}=e;return(0,l.jsx)(ea.Lt,{open:s,onOpenChange:a,children:(0,l.jsxs)(ea.EO,{children:[(0,l.jsxs)(ea.wd,{children:[(0,l.jsx)(ea.r7,{children:"\xbfEliminar contrato?"}),(0,l.jsxs)(ea.$v,{children:["Esta acci\xf3n eliminar\xe1 permanentemente el contrato",t&&(0,l.jsxs)(l.Fragment,{children:[" ",(0,l.jsxs)("strong",{children:["“",t,"”"]})]})," ","y todos sus datos asociados. Esta acci\xf3n no se puede deshacer."]})]}),(0,l.jsxs)(ea.ck,{children:[(0,l.jsx)(ea.Zr,{disabled:n,children:"Cancelar"}),(0,l.jsx)(ea.Rx,{onClick:r,disabled:n,className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",children:n?"Eliminando...":"Eliminar"})]})]})})};var er=a(23227),et=a(69074),en=a(5196),ei=a(17580),ec=a(71007),ed=a(81586),eo=a(7930),em=a(43126),ex=a(51775),eu=a(5475),eh=a(10464),ej=a(72273);let ep=F.Ik({serviceId:F.Yj().min(1,"Debe seleccionar un servicio"),name:F.Yj().min(1,"El nombre del contrato es obligatorio").min(3,"El nombre debe tener al menos 3 caracteres").max(200,"El nombre no puede exceder 200 caracteres"),university:F.Yj().min(1,"La universidad es obligatoria").min(3,"La universidad debe tener al menos 3 caracteres"),career:F.Yj().min(1,"La carrera es obligatoria").min(3,"La carrera debe tener al menos 3 caracteres"),observation:F.Yj().optional(),collaboratorId:F.Yj().min(1,"Debe seleccionar un colaborador"),researchClientIds:F.YO(F.Yj()).min(1,"Debe seleccionar al menos un cliente").max(3,"M\xe1ximo 3 clientes permitidos")}),ev=e=>{var s,a,r;let{initialData:t,onNext:i}=e,[c]=(0,o.useState)(""),[d,x]=(0,o.useState)(!1),[u,h]=(0,o.useState)(!1),p=(0,V.mN)({resolver:(0,z.u)(ep),defaultValues:{serviceId:(null==t?void 0:t.serviceId)||"",name:(null==t?void 0:t.name)||"",university:(null==t?void 0:t.university)||"",career:(null==t?void 0:t.career)||"",observation:(null==t?void 0:t.observation)||"",collaboratorId:(null==t?void 0:t.collaboratorId)||"",researchClientIds:(null==t?void 0:t.researchClientIds)||[]}}),{data:b}=(0,g.A$)({isActive:!0,limit:100}),{data:f,refetch:N}=(0,eo.kp)({search:c.length>=2?c:void 0,isActive:!0,limit:100}),y=(null==f||null==(s=f.data)?void 0:s.filter(e=>e.role===eu.gG.COLLABORATOR_INTERNAL||e.role===eu.gG.COLLABORATOR_EXTERNAL))||[],{data:C,refetch:w}=(0,ex.r8)({limit:100}),I=(null==b||null==(a=b.data)?void 0:a.map(e=>({value:e.id,label:e.name})))||[],E=y.map(e=>({value:e.id,label:"".concat(e.profile.documentNumber," - ").concat(e.profile.firstName," ").concat(e.profile.lastName)})),A=(null==C||null==(r=C.data)?void 0:r.map(e=>({value:e.id,label:"".concat(e.profile.documentNumber," - ").concat(e.profile.firstName," ").concat(e.profile.lastName)})))||[],S=async()=>{x(!1),await N()},P=async()=>{h(!1),await w()};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Informaci\xf3n B\xe1sica del Contrato"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Complete la informaci\xf3n general del contrato y seleccione los participantes"})]}),(0,l.jsx)(q.lV,{...p,children:(0,l.jsxs)("form",{onSubmit:p.handleSubmit(e=>{i(e)}),className:"space-y-6",children:[(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(er.A,{className:"h-5 w-5"}),"Informaci\xf3n del Contrato"]})}),(0,l.jsxs)(v.Wu,{className:"space-y-4",children:[(0,l.jsx)(q.zB,{control:p.control,name:"serviceId",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Servicio *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(em.Zi,{options:I,value:s.value,onValueChange:s.onChange,placeholder:"Seleccionar servicio...",searchPlaceholder:"Buscar servicio...",emptyMessage:"No se encontraron servicios"})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:p.control,name:"name",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Nombre del Contrato *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(j.p,{placeholder:"Ej: Tesis de Ingenier\xeda de Sistemas - UNI",...s})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(q.zB,{control:p.control,name:"university",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Universidad *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(j.p,{placeholder:"Ej: Universidad Nacional de Ingenier\xeda",...s})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:p.control,name:"career",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Carrera *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(j.p,{placeholder:"Ej: Ingenier\xeda de Sistemas",...s})}),(0,l.jsx)(q.C5,{})]})}})]}),(0,l.jsx)(q.zB,{control:p.control,name:"observation",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Observaciones"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(Z.T,{placeholder:"Observaciones adicionales sobre el contrato...",rows:3,...s})}),(0,l.jsx)(q.C5,{})]})}})]})]}),(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(ec.A,{className:"h-5 w-5"}),"Colaborador Responsable"]}),(0,l.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>x(!0),className:"flex items-center gap-2",children:[(0,l.jsx)(m.A,{className:"h-4 w-4"}),"A\xf1adir Nuevo"]})]})}),(0,l.jsx)(v.Wu,{children:(0,l.jsx)(q.zB,{control:p.control,name:"collaboratorId",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Colaborador *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(em.Zi,{options:E,value:s.value,onValueChange:s.onChange,placeholder:"Seleccionar colaborador...",searchPlaceholder:"Buscar por nombre o DNI...",emptyMessage:"No se encontraron colaboradores"},"collaborators-".concat(y.length))}),(0,l.jsx)(q.C5,{})]})}})})]}),(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(ei.A,{className:"h-5 w-5"}),"Clientes de Investigaci\xf3n"]}),(0,l.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>h(!0),className:"flex items-center gap-2",children:[(0,l.jsx)(m.A,{className:"h-4 w-4"}),"A\xf1adir Nuevo"]})]})}),(0,l.jsx)(v.Wu,{children:(0,l.jsx)(q.zB,{control:p.control,name:"researchClientIds",render:e=>{var s;let{field:a}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Clientes *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(em.KF,{options:A,value:a.value,onValueChange:a.onChange,placeholder:"Seleccionar clientes...",searchPlaceholder:"Buscar por nombre o DNI...",emptyMessage:"No se encontraron clientes",maxSelections:3},"clients-".concat((null==C||null==(s=C.data)?void 0:s.length)||0))}),(0,l.jsx)(q.C5,{})]})}})})]}),(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)("button",{type:"submit",className:"px-6 py-2 bg-primary text-primary-foreground rounded-md hover:bg-primary/90 transition-colors",children:"Siguiente: Entregables"})})]})}),(0,l.jsx)(eh.q,{open:d,onOpenChange:x,onUserSaved:S,mode:"create"}),(0,l.jsx)(ej.Z,{open:u,onOpenChange:h,onClientSaved:P,mode:"create"})]})};var eg=a(19946);let eb=(0,eg.A)("square-check-big",[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),ef=(0,eg.A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var eN=a(47262);let ey=F.Ik({deliverableIds:F.YO(F.Yj()).min(1,"Debe seleccionar al menos un entregable")}),eC=e=>{let{serviceId:s,initialData:a,onNext:r,onBack:t}=e,i=(0,V.mN)({resolver:(0,z.u)(ey),defaultValues:{deliverableIds:(null==a?void 0:a.deliverableIds)||[]}}),{data:c,isLoading:d}=(0,g.EQ)(s),m=i.watch("deliverableIds"),x=(0,o.useMemo)(()=>(null==c?void 0:c.data)||[],[null==c?void 0:c.data]),u=(0,o.useCallback)(e=>{let s,a=i.getValues("deliverableIds");s=a.includes(e)?a.filter(s=>s!==e):[...a,e],i.setValue("deliverableIds",s)},[i]),h=(0,o.useCallback)(()=>{let e=x.map(e=>e.id);e.every(e=>m.includes(e))?i.setValue("deliverableIds",[]):i.setValue("deliverableIds",e)},[x,m,i]),j=x.length>0&&x.every(e=>m.includes(e.id));return d?(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Entregables del Contrato"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Cargando entregables..."})]}),(0,l.jsx)(v.Zp,{children:(0,l.jsx)(v.Wu,{className:"p-8",children:(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})})]}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Entregables del Contrato"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Seleccione los entregables que formar\xe1n parte de este contrato"})]}),(0,l.jsx)(q.lV,{...i,children:(0,l.jsxs)("form",{onSubmit:i.handleSubmit(e=>{r(e)}),className:"space-y-6",children:[(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(f.A,{className:"h-5 w-5"}),"Entregables Disponibles",m.length>0&&(0,l.jsxs)(y.E,{variant:"secondary",children:[m.length," seleccionados"]})]}),x.length>0&&(0,l.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:h,className:"flex items-center gap-2",children:j?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(eb,{className:"h-4 w-4"}),"Deseleccionar Todo"]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ef,{className:"h-4 w-4"}),"Seleccionar Todo"]})})]})}),(0,l.jsx)(v.Wu,{children:(0,l.jsx)(q.zB,{control:i.control,name:"deliverableIds",render:()=>(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{className:"sr-only",children:"Entregables"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)("div",{className:"space-y-3",children:0===x.length?(0,l.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,l.jsx)(f.A,{className:"mx-auto h-12 w-12 opacity-50 mb-4"}),(0,l.jsx)("p",{children:"No hay entregables disponibles para este servicio"}),(0,l.jsx)("p",{className:"text-sm",children:"Contacte al administrador para agregar entregables"})]}):x.map(e=>{let s=m.includes(e.id);return(0,l.jsxs)("div",{className:"flex items-start space-x-3 p-4 border rounded-lg transition-colors cursor-pointer hover:bg-muted/50 ".concat(s?"bg-primary/5 border-primary/30":"bg-background border-border"),onClick:s=>{s.preventDefault(),u(e.id)},children:[(0,l.jsx)("div",{onClick:e=>e.stopPropagation(),children:(0,l.jsx)(eN.S,{checked:s,onCheckedChange:()=>u(e.id),className:"mt-1"})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)("h4",{className:"font-medium",children:e.name}),(0,l.jsx)(y.E,{variant:"outline",className:"text-xs",children:"Entregable"})]}),e.description&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:e.description}),(0,l.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[(0,l.jsxs)("span",{children:["Creado: ",new Date(e.createdAt).toLocaleDateString()]}),(0,l.jsxs)("span",{children:["Estado: ",e.isActive?"Activo":"Inactivo"]})]})]})]},e.id)})})}),(0,l.jsx)(q.C5,{})]})})})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:t,children:"Anterior: Informaci\xf3n B\xe1sica"}),(0,l.jsx)(n.$,{type:"submit",disabled:0===m.length,children:"Siguiente: Fechas y Pagos"})]})]})})]})};var ew=a(55868);let eI=F.Ik({description:F.Yj().min(1,"La descripci\xf3n es obligatoria"),amount:F.ai().min(1,"El monto debe ser mayor a 0"),dueDate:F.p6()}),eE=F.Ik({userId:F.Yj().min(1,"El ID del colaborador es obligatorio"),amount:F.ai().min(1,"El monto debe ser mayor a 0"),dueDate:F.p6(),description:F.Yj().min(1,"La descripci\xf3n es obligatoria")}),eA=F.Ik({costTotal:F.ai().min(1,"El costo total debe ser mayor a 0"),currency:F.k5(["PEN","USD"]),startDate:F.p6(),endDate:F.p6(),paymentType:F.k5(["cash","installments"]),installments:F.YO(eI).optional(),collaboratorPayments:F.YO(eE).optional()}).refine(e=>!e.startDate||!e.endDate||e.startDate<e.endDate,{message:"La fecha de fin debe ser posterior a la fecha de inicio",path:["endDate"]}),eS=e=>{var s;let{initialData:a,onNext:r,onBack:t,collaboratorId:i,collaboratorRole:c,contractName:d}=e,[x,u]=(0,o.useState)((null==a?void 0:a.installments)||[]),[h,g]=(0,o.useState)((null==a||null==(s=a.installments)?void 0:s.length)||2),[b,f]=(0,o.useState)((null==a?void 0:a.collaboratorPayments)||[]),N="COLLABORATOR_EXTERNAL"===c,w=(0,V.mN)({resolver:(0,z.u)(eA),defaultValues:{costTotal:(null==a?void 0:a.costTotal)||0,currency:(null==a?void 0:a.currency)||"PEN",startDate:(null==a?void 0:a.startDate)||new Date,endDate:(null==a?void 0:a.endDate)||new Date(Date.now()+2592e6),paymentType:(null==a?void 0:a.paymentType)||"cash",installments:x,collaboratorPayments:b}}),I=w.watch("paymentType"),E=w.watch("startDate"),A=w.watch("endDate"),S=w.watch("costTotal");(0,o.useEffect)(()=>{N&&i&&d&&A&&f(e=>{if(0===e.length){let e={userId:i,amount:0,dueDate:A,description:"Pago colaborador - ".concat(d)};return w.setValue("collaboratorPayments",[e]),[e]}{let s=e.map(e=>({...e,dueDate:A}));return w.setValue("collaboratorPayments",s),s}})},[N,i,d,A,w]);let P=(0,o.useCallback)(()=>{if("installments"===I&&E&&A&&S>0&&h>0){let e=Math.floor(S/h*100)/100,s=Math.round((S-e*h)*100)/100,a=[],l=Math.ceil(Math.ceil((A.getTime()-E.getTime())/864e5)/h);for(let r=0;r<h;r++){let t=new Date(E);t.setDate(t.getDate()+l*(r+1));let n=r===h-1?e+s:e;a.push({description:"Cuota ".concat(r+1," de ").concat(h),amount:n,dueDate:t})}u(a),w.setValue("installments",a)}},[I,E,A,S,h,w]);(0,o.useEffect)(()=>{P()},[P]),(0,o.useEffect)(()=>{"installments"===I&&0===x.length&&P()},[I,x.length,P]);let D=(e,s,a)=>{let l=[...x];l[e]={...l[e],[s]:a},u(l),w.setValue("installments",l)},k=(e,s,a)=>{let l=[...b];l[e]={...l[e],[s]:a},f(l),w.setValue("collaboratorPayments",l)},R=x.reduce((e,s)=>e+s.amount,0),T=S-R;return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold",children:"Fechas y Configuraci\xf3n de Pagos"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Configure las fechas del proyecto y el esquema de pagos"})]}),(0,l.jsx)(q.lV,{...w,children:(0,l.jsxs)("form",{onSubmit:w.handleSubmit(e=>{"installments"===e.paymentType?e.installments=x:e.installments=[{description:"Pago \xfanico",amount:e.costTotal,dueDate:e.endDate}],N&&(e.collaboratorPayments=b),r(e)}),className:"space-y-6",children:[(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(ew.A,{className:"h-5 w-5"}),"Informaci\xf3n Financiera"]})}),(0,l.jsx)(v.Wu,{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(q.zB,{control:w.control,name:"costTotal",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Costo Total *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(j.p,{type:"number",placeholder:"0.00",...s,onChange:e=>s.onChange(Number(e.target.value))})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:w.control,name:"currency",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Moneda *"}),(0,l.jsxs)(p.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(q.MJ,{children:(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Seleccionar moneda"})})}),(0,l.jsxs)(p.gC,{children:[(0,l.jsx)(p.eb,{value:"PEN",children:"Soles (PEN)"}),(0,l.jsx)(p.eb,{value:"USD",children:"D\xf3lares (USD)"})]})]}),(0,l.jsx)(q.C5,{})]})}})]})})]}),(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(et.A,{className:"h-5 w-5"}),"Fechas del Proyecto"]})}),(0,l.jsx)(v.Wu,{className:"space-y-4",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(q.zB,{control:w.control,name:"startDate",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Fecha de Inicio *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(em.J3,{value:s.value,onChange:s.onChange,placeholder:"Seleccionar fecha de inicio"})}),(0,l.jsx)(q.C5,{})]})}}),(0,l.jsx)(q.zB,{control:w.control,name:"endDate",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Fecha de Finalizaci\xf3n *"}),(0,l.jsx)(q.MJ,{children:(0,l.jsx)(em.J3,{value:s.value,onChange:s.onChange,placeholder:"Seleccionar fecha de fin"})}),(0,l.jsx)(q.C5,{})]})}})]})})]}),N&&(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(ec.A,{className:"h-5 w-5"}),"Pago de Colaborador Externo"]})}),(0,l.jsx)(v.Wu,{className:"space-y-4",children:b.map((e,s)=>(0,l.jsxs)("div",{className:"p-4 border rounded-lg space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Monto del Pago *"}),(0,l.jsx)(j.p,{type:"number",value:e.amount,onChange:e=>k(s,"amount",Number(e.target.value)),placeholder:"0.00"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Fecha de Pago *"}),(0,l.jsx)(em.J3,{value:e.dueDate,onChange:e=>k(s,"dueDate",e),placeholder:"Seleccionar fecha"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Descripci\xf3n *"}),(0,l.jsx)(j.p,{value:e.description,onChange:e=>k(s,"description",e.target.value),placeholder:"Descripci\xf3n del pago"})]})]},s))})]}),(0,l.jsxs)(v.Zp,{children:[(0,l.jsx)(v.aR,{children:(0,l.jsxs)(v.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(ed.A,{className:"h-5 w-5"}),"Configuraci\xf3n de Pagos"]})}),(0,l.jsxs)(v.Wu,{className:"space-y-4",children:[(0,l.jsx)(q.zB,{control:w.control,name:"paymentType",render:e=>{let{field:s}=e;return(0,l.jsxs)(q.eI,{children:[(0,l.jsx)(q.lR,{children:"Tipo de Pago *"}),(0,l.jsxs)(p.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(q.MJ,{children:(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Seleccionar tipo de pago"})})}),(0,l.jsxs)(p.gC,{children:[(0,l.jsx)(p.eb,{value:"cash",children:"Pago al Contado"}),(0,l.jsx)(p.eb,{value:"installments",children:"Pago en Cuotas"})]})]}),(0,l.jsx)(q.C5,{})]})}}),"installments"===I&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"N\xfamero de Cuotas *"}),(0,l.jsxs)(p.l6,{value:h.toString(),onValueChange:e=>g(Number(e)),children:[(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"Seleccionar cuotas"})}),(0,l.jsx)(p.gC,{children:[2,3,4,5,6,7,8,9,10,12].map(e=>(0,l.jsxs)(p.eb,{value:e.toString(),children:[e," cuotas"]},e))})]})]}),(0,l.jsx)("div",{className:"flex items-end",children:(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:P,className:"w-full",children:"Recalcular Cuotas"})})]}),"installments"===I&&(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("h4",{className:"font-medium",children:["Cronograma de Cuotas (",x.length," cuotas)"]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[0!==T&&(0,l.jsxs)(y.E,{variant:T>0?"destructive":"secondary",children:[T>0?"Faltan":"Sobran",": ",Math.abs(T).toFixed(2)]}),(0,l.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{let e={description:"Cuota ".concat(x.length+1),amount:0,dueDate:new Date},s=[...x,e];u(s),w.setValue("installments",s)},children:[(0,l.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Agregar Cuota"]})]})]}),(0,l.jsx)("div",{className:"space-y-3",children:x.map((e,s)=>(0,l.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("h5",{className:"font-medium",children:["Cuota ",s+1]}),x.length>1&&(0,l.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>(e=>{let s=x.filter((s,a)=>a!==e);u(s),w.setValue("installments",s)})(s),children:(0,l.jsx)(C.A,{className:"h-4 w-4"})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Descripci\xf3n"}),(0,l.jsx)(j.p,{value:e.description,onChange:e=>D(s,"description",e.target.value),placeholder:"Descripci\xf3n de la cuota"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Monto"}),(0,l.jsx)(j.p,{type:"number",value:e.amount,onChange:e=>D(s,"amount",Number(e.target.value)),placeholder:"0.00"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-sm font-medium",children:"Fecha de Vencimiento"}),(0,l.jsx)(em.J3,{value:e.dueDate,onChange:e=>D(s,"dueDate",e),placeholder:"Seleccionar fecha"})]})]})]},s))}),x.length>0&&(0,l.jsx)("div",{className:"p-4 bg-muted/50 rounded-lg",children:(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsx)("span",{className:"font-medium",children:"Total en Cuotas:"}),(0,l.jsxs)("span",{className:"font-bold",children:[R.toFixed(2)," ",w.watch("currency")]})]})})]})]})]}),(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:t,children:"Anterior: Entregables"}),(0,l.jsx)(n.$,{type:"submit",disabled:"installments"===I&&0!==T,children:"Siguiente: Resumen"})]})]})})]})},eP=e=>{var s;let{onSuccess:a,onCancel:r,open:t,onOpenChange:i,initialData:c,onSubmit:d}=e,[m,h]=(0,o.useState)(1),[j,p]=(0,o.useState)(c||{}),g=(0,u.U0)(),{data:b}=(0,eo.kp)({limit:1e3}),N=null==b||null==(s=b.data)?void 0:s.find(e=>e.id===j.collaboratorId),C=[{number:1,title:"Informaci\xf3n B\xe1sica",icon:er.A,description:"Datos del contrato y participantes"},{number:2,title:"Entregables",icon:f.A,description:"Selecci\xf3n de entregables"},{number:3,title:"Fechas y Pagos",icon:et.A,description:"Cronograma y configuraci\xf3n financiera"},{number:4,title:"Resumen",icon:A.A,description:"Revisi\xf3n final antes de crear"}],w=e=>{p(s=>({...s,...e})),h(2)},I=e=>{p(s=>({...s,...e})),h(3)},E=e=>{p(s=>({...s,...e})),h(4)},S=async()=>{if(j&&P(j))try{let e=D(j);await g.mutateAsync(e),null==a||a(),null==d||d(j),k()}catch(e){console.error("Error al crear el contrato:",e)}},P=e=>{var s,a;return!!(e.serviceId&&e.name&&e.university&&e.career&&e.collaboratorId&&(null==(s=e.researchClientIds)?void 0:s.length)&&(null==(a=e.deliverableIds)?void 0:a.length)&&e.costTotal&&e.currency&&e.startDate&&e.endDate)},D=e=>{var s,a;let l=[e.collaboratorId,...e.researchClientIds];return{serviceId:e.serviceId,name:e.name,university:e.university,career:e.career,observation:e.observation||"",costTotal:Number(e.costTotal),currency:e.currency,startDate:e.startDate.toISOString(),endDate:e.endDate.toISOString(),userIds:l,deliverableIds:e.deliverableIds,installments:(null==(s=e.installments)?void 0:s.map(e=>({description:e.description,amount:Number(e.amount),dueDate:e.dueDate.toISOString()})))||[],collaboratorPayments:(null==(a=e.collaboratorPayments)?void 0:a.map(e=>({userId:e.userId,amount:Number(e.amount),dueDate:e.dueDate.toISOString(),description:e.description})))||void 0}},k=()=>{h(1),p(c||{}),null==i||i(!1),null==r||r()},R=(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsx)("div",{className:"flex flex-col sm:flex-row items-center justify-center sm:justify-between mb-8 px-2 sm:px-4 space-y-4 sm:space-y-0",children:C.map((e,s)=>{let a=e.icon,r=m===e.number,t=m>e.number,n=e.number<=m||1===e.number;return(0,l.jsxs)("div",{className:"flex items-center flex-1 w-full sm:w-auto",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center w-full sm:w-auto",children:[(0,l.jsx)("button",{onClick:()=>n&&(e=>{(e<=m||1===e)&&h(e)})(e.number),disabled:!n,className:"\n                  flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 rounded-full border-2 transition-all\n                  ".concat(t?"bg-green-500 border-green-500 text-white":r?"bg-primary border-primary text-primary-foreground":n?"bg-background border-muted-foreground text-muted-foreground hover:border-primary hover:text-primary":"bg-muted border-muted text-muted-foreground cursor-not-allowed","\n                "),children:t?(0,l.jsx)(en.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}):(0,l.jsx)(a,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),(0,l.jsxs)("div",{className:"mt-1 sm:mt-2 text-center max-w-20 sm:max-w-none",children:[(0,l.jsx)("div",{className:"text-xs sm:text-sm font-medium ".concat(r?"text-primary":"text-muted-foreground"),children:e.title}),(0,l.jsx)("div",{className:"text-xs text-muted-foreground hidden lg:block",children:e.description})]})]}),s<C.length-1&&(0,l.jsx)("div",{className:"hidden sm:block flex-1 h-0.5 mx-2 sm:mx-4 ".concat(t?"bg-green-500":"bg-muted")})]},e.number)})}),(()=>{switch(m){case 1:return(0,l.jsx)(ev,{initialData:{serviceId:j.serviceId||"",name:j.name||"",university:j.university||"",career:j.career||"",observation:j.observation||"",collaboratorId:j.collaboratorId||"",researchClientIds:j.researchClientIds||[]},onNext:w});case 2:return(0,l.jsx)(eC,{serviceId:j.serviceId||"",initialData:{deliverableIds:j.deliverableIds||[]},onNext:I,onBack:()=>h(1)});case 3:return(0,l.jsx)(eS,{initialData:j,onNext:E,onBack:()=>h(2),collaboratorId:j.collaboratorId,collaboratorRole:null==N?void 0:N.role,contractName:j.name});case 4:return(()=>{var e,s,a,r,t;return(0,l.jsxs)("div",{className:"space-y-6 sm:space-y-8 max-w-6xl mx-auto px-4 sm:px-0",children:[(0,l.jsxs)("div",{className:"text-center space-y-4",children:[(0,l.jsx)("div",{className:"inline-flex items-center justify-center w-12 h-12 sm:w-16 sm:h-16 bg-primary/10 rounded-full mb-4",children:(0,l.jsx)(A.A,{className:"h-6 w-6 sm:h-8 sm:w-8 text-primary"})}),(0,l.jsx)("h2",{className:"text-2xl sm:text-3xl font-bold",children:"Resumen del Contrato"}),(0,l.jsx)("p",{className:"text-muted-foreground text-base sm:text-lg max-w-2xl mx-auto px-4 sm:px-0",children:"Revise cuidadosamente toda la informaci\xf3n antes de crear el contrato"})]}),(0,l.jsx)("div",{className:"bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-4 sm:p-6 border border-primary/20",children:(0,l.jsxs)("div",{className:"text-center space-y-2",children:[(0,l.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-primary",children:j.name}),(0,l.jsxs)("p",{className:"text-base sm:text-lg text-muted-foreground",children:[j.university," - ",j.career]}),(0,l.jsx)("div",{className:"inline-flex items-center gap-2 mt-4 px-3 sm:px-4 py-2 bg-primary text-primary-foreground rounded-full",children:(0,l.jsxs)("span",{className:"text-lg sm:text-2xl font-bold",children:[j.costTotal," ",j.currency]})})]})}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-2",children:[(0,l.jsx)(v.Zp,{className:"h-fit",children:(0,l.jsxs)(v.Wu,{className:"p-6",children:[(0,l.jsxs)("h3",{className:"font-semibold mb-6 flex items-center gap-2 text-lg",children:[(0,l.jsx)(er.A,{className:"h-5 w-5 text-primary"}),"Informaci\xf3n del Contrato"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground",children:"Servicio:"}),(0,l.jsx)("span",{className:"text-right max-w-xs",children:j.serviceId})]}),(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground",children:"Universidad:"}),(0,l.jsx)("span",{className:"text-right max-w-xs",children:j.university})]}),(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground",children:"Carrera:"}),(0,l.jsx)("span",{className:"text-right max-w-xs",children:j.career})]}),j.observation&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("hr",{className:"my-4"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground block mb-2",children:"Observaciones:"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md",children:j.observation})]})]})]})]})}),(0,l.jsx)(v.Zp,{className:"h-fit",children:(0,l.jsxs)(v.Wu,{className:"p-6",children:[(0,l.jsxs)("h3",{className:"font-semibold mb-6 flex items-center gap-2 text-lg",children:[(0,l.jsx)(ei.A,{className:"h-5 w-5 text-primary"}),"Participantes"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(ec.A,{className:"h-4 w-4 text-muted-foreground"}),(0,l.jsx)("span",{className:"font-medium text-muted-foreground",children:"Colaborador Responsable"})]}),(0,l.jsx)(y.E,{variant:"outline",className:"ml-6",children:"1 colaborador"})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(ei.A,{className:"h-4 w-4 text-muted-foreground"}),(0,l.jsx)("span",{className:"font-medium text-muted-foreground",children:"Clientes de Investigaci\xf3n"})]}),(0,l.jsxs)(y.E,{variant:"outline",className:"ml-6",children:[(null==(e=j.researchClientIds)?void 0:e.length)||0," clientes"]})]})]})]})}),(0,l.jsx)(v.Zp,{className:"h-fit",children:(0,l.jsxs)(v.Wu,{className:"p-6",children:[(0,l.jsxs)("h3",{className:"font-semibold mb-6 flex items-center gap-2 text-lg",children:[(0,l.jsx)(f.A,{className:"h-5 w-5 text-primary"}),"Entregables del Proyecto"]}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-muted-foreground",children:"Total de entregables:"}),(0,l.jsx)(y.E,{variant:"secondary",className:"text-lg px-3 py-1",children:(null==(s=j.deliverableIds)?void 0:s.length)||0})]})]})}),(0,l.jsx)(v.Zp,{className:"h-fit",children:(0,l.jsxs)(v.Wu,{className:"p-6",children:[(0,l.jsxs)("h3",{className:"font-semibold mb-6 flex items-center gap-2 text-lg",children:[(0,l.jsx)(et.A,{className:"h-5 w-5 text-primary"}),"Cronograma y Pagos"]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground block",children:"Fecha de Inicio"}),(0,l.jsx)("span",{className:"text-lg",children:null==(a=j.startDate)?void 0:a.toLocaleDateString()})]}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground block",children:"Fecha de Fin"}),(0,l.jsx)("span",{className:"text-lg",children:null==(r=j.endDate)?void 0:r.toLocaleDateString()})]})]}),(0,l.jsx)("hr",{}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"font-medium text-muted-foreground",children:"Modalidad de Pago:"}),(0,l.jsx)(y.E,{variant:"cash"===j.paymentType?"default":"secondary",children:"cash"===j.paymentType?"Pago al Contado":"".concat((null==(t=j.installments)?void 0:t.length)||0," Cuotas")})]})]})]})})]}),"installments"===j.paymentType&&j.installments&&(0,l.jsx)(v.Zp,{children:(0,l.jsxs)(v.Wu,{className:"p-6",children:[(0,l.jsxs)("h3",{className:"font-semibold mb-6 flex items-center gap-2 text-lg",children:[(0,l.jsx)(ed.A,{className:"h-5 w-5 text-primary"}),"Cronograma de Cuotas"]}),(0,l.jsx)("div",{className:"grid gap-3 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:j.installments.map((e,s)=>(0,l.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-muted/50 transition-colors",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-2",children:(0,l.jsx)(y.E,{variant:"outline",className:"text-xs",children:e.description})}),(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"text-xl font-bold text-primary",children:[e.amount.toFixed(2)," ",j.currency]}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Vence: ",e.dueDate.toLocaleDateString()]})]})]},s))}),(0,l.jsx)("div",{className:"mt-6 p-4 bg-muted/50 rounded-lg",children:(0,l.jsxs)("div",{className:"flex justify-between items-center text-lg font-semibold",children:[(0,l.jsx)("span",{children:"Total del Contrato:"}),(0,l.jsxs)("span",{className:"text-primary",children:[j.installments.reduce((e,s)=>e+s.amount,0).toFixed(2)," ",j.currency]})]})})]})}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 sm:justify-between pt-8 border-t",children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>h(3),size:"lg",className:"w-full sm:w-auto",children:"Anterior: Fechas y Pagos"}),(0,l.jsx)(n.$,{onClick:S,disabled:g.isPending,className:"text-white w-full sm:w-auto",size:"lg",children:g.isPending?"Procesando...":"Crear Contrato"})]})]})})();default:return null}})()]});return void 0!==t&&i?(0,l.jsx)(x.lG,{open:t,onOpenChange:i,children:(0,l.jsxs)(x.Cf,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,l.jsx)(x.c7,{className:"border-b pb-4",children:(0,l.jsx)(x.L3,{className:"text-xl",children:"Crear Nuevo Contrato"})}),(0,l.jsx)("div",{className:"py-6",children:R})]})}):R};function eD(){let[e,s]=(0,o.useState)({page:1,limit:10}),[a,r]=(0,o.useState)({open:!1,contractId:null,contractName:null}),[t,i]=(0,o.useState)({open:!1}),{data:c,isLoading:d,error:h,refetch:j}=(0,u.n)(e),p=(0,u.n9)(),v=(0,o.useMemo)(()=>(null==c?void 0:c.data)||[],[null==c?void 0:c.data]),g=null==c?void 0:c.meta,f=(0,o.useCallback)(e=>{s(s=>({...s,page:e}))},[]),N=(0,o.useCallback)(e=>{s(s=>({...s,limit:e,page:1}))},[]),y=(0,o.useCallback)(e=>{s(s=>({...s,...e,page:1}))},[]),C=(0,o.useCallback)(()=>{s({page:1,limit:10})},[]),w=()=>{i({open:!1})},I=(0,o.useCallback)(e=>{let s=v.find(s=>s.id===e);r({open:!0,contractId:e,contractName:(null==s?void 0:s.name)||null})},[v]),E=(0,o.useCallback)(async()=>{if(a.contractId)try{await p.mutateAsync(a.contractId),r({open:!1,contractId:null,contractName:null})}catch(e){console.error("Error eliminando contrato:",e)}},[a.contractId,p]),A={totalContracts:(null==g?void 0:g.total)||v.length,activeContracts:v.filter(e=>e.overallProgress<100).length,completedContracts:v.filter(e=>100===e.overallProgress).length,thisMonthContracts:0,totalRevenue:v.reduce((e,s)=>e+s.costTotal,0),avgProgress:v.length>0?Math.round(v.reduce((e,s)=>e+s.overallProgress,0)/v.length):0};return h?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,l.jsx)("p",{className:"text-lg text-red-600 mb-4",children:"Error al cargar los contratos"}),(0,l.jsx)(n.$,{onClick:()=>j(),variant:"outline",children:"Intentar nuevamente"})]}):(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Gesti\xf3n de Proyectos"}),(0,l.jsx)("p",{className:"text-muted-foreground",children:"Administra y supervisa todos los contratos de proyectos"})]}),(0,l.jsxs)(n.$,{onClick:()=>{i({open:!0})},className:"text-white",children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Nuevo Proyecto"]})]}),(0,l.jsx)(es,{data:A}),(0,l.jsx)(b,{filters:e,onFiltersChange:y,onClearFilters:C}),(0,l.jsx)("div",{className:"space-y-4",children:(0,l.jsx)(X,{data:v,isLoading:d,onDelete:I,serverPagination:!0,paginationMeta:g,onPageChange:f,onPageSizeChange:N})}),(0,l.jsx)(el,{open:a.open,onOpenChange:e=>r(s=>({...s,open:e})),onConfirm:E,contractName:a.contractName||void 0,isLoading:p.isPending}),(0,l.jsx)(x.lG,{open:t.open,onOpenChange:e=>{e||w()},children:(0,l.jsxs)(x.Cf,{className:"max-w-[95vw] w-[95vw] max-h-[85vh] overflow-y-auto",style:{width:"80vw",maxWidth:"70vw"},children:[(0,l.jsx)(x.c7,{children:(0,l.jsx)(x.L3,{children:"Nuevo Contrato"})}),(0,l.jsx)(eP,{onSuccess:()=>{w(),j()},onCancel:w})]})})]})}function ek(){return(0,l.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,l.jsxs)("header",{className:"bg-background/60 backdrop-blur-md sticky top-0 z-50 flex h-12 shrink-0 items-center gap-2 border-b px-4",children:[(0,l.jsx)(c.SidebarTrigger,{className:"-ml-1"}),(0,l.jsx)(i.Separator,{orientation:"vertical",className:"mr-2 h-4"}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)(t.Qp,{children:(0,l.jsx)(t.AB,{children:(0,l.jsx)(t.J5,{children:(0,l.jsx)(t.tJ,{children:"Gesti\xf3n de Proyectos"})})})})}),(0,l.jsxs)("div",{className:"ml-auto mr-4",children:[(0,l.jsx)(r.default,{}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon","aria-label":"Notificaciones",className:"mr-2",children:(0,l.jsx)(d.A,{className:"h-5 w-5"})})]})]}),(0,l.jsx)("div",{className:"flex flex-1 flex-col gap-6 p-4 md:p-6",children:(0,l.jsx)(eD,{})})]})}a(79377)},33109:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(19946).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},36040:(e,s,a)=>{"use strict";a.d(s,{V:()=>n});var l=a(90697);class r{async getServices(e){let s=new URLSearchParams;(null==e?void 0:e.page)&&s.append("page",e.page.toString()),(null==e?void 0:e.limit)&&s.append("limit",e.limit.toString()),(null==e?void 0:e.search)&&s.append("search",e.search),(null==e?void 0:e.isActive)!==void 0&&s.append("isActive",e.isActive.toString());let a=s.toString(),r=a?"".concat(this.baseEndpoint,"?").concat(a):this.baseEndpoint;return await l.q.get(r)}async getServiceById(e){return await l.q.get("".concat(this.baseEndpoint,"/").concat(e))}async createService(e){return await l.q.post(this.baseEndpoint,e)}async updateService(e,s){return await l.q.patch("".concat(this.baseEndpoint,"/").concat(e),s)}async deleteService(e){return await l.q.delete("".concat(this.baseEndpoint,"/").concat(e))}async getDeliverablesByServiceId(e){return await l.q.get("".concat(this.baseEndpoint,"/").concat(e,"/deliverables"))}constructor(){this.baseEndpoint="/engagements"}}let t=new r,n={getServices:e=>t.getServices(e),getServiceById:e=>t.getServiceById(e),createService:e=>t.createService(e),updateService:(e,s)=>t.updateService(e,s),deleteService:e=>t.deleteService(e),getDeliverablesByServiceId:e=>t.getDeliverablesByServiceId(e)}},48883:(e,s,a)=>{Promise.resolve().then(a.bind(a,1965))},69074:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(19946).A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},78534:(e,s,a)=>{"use strict";a.d(s,{A$:()=>d,EQ:()=>u,Rv:()=>o,iM:()=>m,if:()=>x});var l=a(95838),r=a(26715),t=a(5041),n=a(36040),i=a(87481);let c={all:["engagements"],lists:()=>[...c.all,"list"],list:e=>[...c.lists(),e],details:()=>[...c.all,"detail"],detail:e=>[...c.details(),e],deliverables:()=>[...c.all,"deliverables"],deliverablesList:e=>[...c.deliverables(),e]},d=e=>(0,l.useQuery)({queryKey:c.list(e),queryFn:()=>n.V.getServices(e),refetchOnWindowFocus:!0,staleTime:0}),o=()=>{let e=(0,r.useQueryClient)(),{showSuccess:s,showError:a}=(0,i.d)();return(0,t.useMutation)({mutationFn:n.V.createService,onSuccess:()=>{s("created",{title:"Servicio creado",description:"El servicio  ha sido creado exitosamente."}),e.invalidateQueries({queryKey:c.lists()}),e.invalidateQueries({queryKey:["all-services-for-select"]}),e.invalidateQueries({queryKey:["services-for-select"]})},onError:e=>{console.error("Error creating service:",e),a("error",{title:"Error creando servicio",description:"No se pudo crear el servicio: ".concat(e.message)})}})},m=()=>{let e=(0,r.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>{let{serviceId:s,serviceData:a}=e;return n.V.updateService(s,a)},onSuccess:(s,a)=>{e.invalidateQueries({queryKey:c.lists()}),e.invalidateQueries({queryKey:c.detail(a.serviceId)}),e.invalidateQueries({queryKey:["all-services-for-select"]}),e.invalidateQueries({queryKey:["services-for-select"]})},onError:e=>{console.error("Error updating service:",e)}})},x=()=>{let e=(0,r.useQueryClient)();return(0,t.useMutation)({mutationFn:n.V.deleteService,onSuccess:()=>{e.invalidateQueries({queryKey:c.lists()}),e.invalidateQueries({queryKey:["all-services-for-select"]}),e.invalidateQueries({queryKey:["services-for-select"]})},onError:e=>{console.error("Error deleting service:",e)}})},u=e=>(0,l.useQuery)({queryKey:c.deliverablesList(e),queryFn:()=>n.V.getDeliverablesByServiceId(e),enabled:!!e,staleTime:3e5,gcTime:6e5})},85339:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(19946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])}},e=>{e.O(0,[9558,5041,8859,5089,221,8034,2764,5838,2896,3240,4348,1339,8403,8889,3794,464,2273,5104,8441,5964,7358],()=>e(e.s=48883)),_N_E=e.O()}]);