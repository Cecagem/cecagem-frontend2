"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2273],{51775:(e,r,a)=>{a.d(r,{bL:()=>h,eH:()=>c,er:()=>u,r8:()=>d,tn:()=>m});var t=a(95838),n=a(26715),s=a(5041),i=a(56671),l=a(53044);let o={researchClientsWithFilters:e=>["research-clients",e],researchClientsStats:["research-clients","stats"]},c=()=>(0,t.useQuery)({queryKey:o.researchClientsStats,queryFn:async()=>{let e=(await l.X.getResearchClients({limit:1e3})).data,r=new Date,a=new Date(r.getFullYear(),r.getMonth(),1);return{totalClients:e.length,activeClients:e.filter(e=>e.isActive).length,inactiveClients:e.filter(e=>!e.isActive).length,thisMonthClients:e.filter(e=>new Date(e.createdAt)>=a).length}},retry:1,refetchOnWindowFocus:!1}),d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.useQuery)({queryKey:o.researchClientsWithFilters(e),queryFn:()=>l.X.getResearchClients(e),retry:1,refetchOnWindowFocus:!1})},u=()=>{let e=(0,n.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>l.X.createResearchClient(e),onSuccess:()=>{i.oR.success("Cliente de investigaci\xf3n creado exitosamente"),e.invalidateQueries({queryKey:["research-clients"]})},onError:e=>{var r,a;console.error("Error creating research client:",e);let t=(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||"";t.toLowerCase().includes("email")&&t.toLowerCase().includes("exist")?i.oR.error("❌ Este email ya est\xe1 registrado en el sistema"):t.toLowerCase().includes("validation")||t.toLowerCase().includes("required")||t.toLowerCase().includes("invalid")?i.oR.error("❌ Datos inv\xe1lidos: Verifica que todos los campos est\xe9n correctos"):t.toLowerCase().includes("document")&&t.toLowerCase().includes("exist")?i.oR.error("❌ Este n\xfamero de documento ya est\xe1 registrado"):i.oR.error(t||"Error al crear el cliente. Intenta nuevamente.")}})},m=()=>{let e=(0,n.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>{let{id:r,data:a}=e;return l.X.updateResearchClient(r,a)},onSuccess:()=>{i.oR.success("Cliente de investigaci\xf3n actualizado exitosamente"),e.invalidateQueries({queryKey:["research-clients"]})},onError:e=>{var r,a;console.error("Error updating research client:",e);let t=(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||"";t.toLowerCase().includes("email")&&t.toLowerCase().includes("exist")?i.oR.error("❌ Este email ya est\xe1 registrado por otro usuario"):t.toLowerCase().includes("validation")||t.toLowerCase().includes("required")||t.toLowerCase().includes("invalid")?i.oR.error("❌ Datos inv\xe1lidos: Verifica que todos los campos est\xe9n correctos"):t.toLowerCase().includes("not found")||t.toLowerCase().includes("no encontrado")?i.oR.error("❌ Cliente no encontrado"):t.toLowerCase().includes("document")&&t.toLowerCase().includes("exist")?i.oR.error("❌ Este n\xfamero de documento ya est\xe1 registrado"):i.oR.error(t||"Error al actualizar el cliente. Intenta nuevamente.")}})},h=()=>{let e=(0,n.useQueryClient)();return(0,s.useMutation)({mutationFn:e=>l.X.deleteResearchClient(e),onSuccess:()=>{i.oR.success("Cliente de investigaci\xf3n eliminado correctamente"),e.invalidateQueries({queryKey:["research-clients"]})},onError:e=>{var r,a;console.error("Error deleting research client:",e);let t=(null==e||null==(a=e.response)||null==(r=a.data)?void 0:r.message)||(null==e?void 0:e.message)||"";t.toLowerCase().includes("not found")?i.oR.error("❌ Cliente no encontrado"):t.toLowerCase().includes("constraint")||t.toLowerCase().includes("referenced")?i.oR.error("❌ No se puede eliminar: El cliente tiene registros asociados"):i.oR.error(t||"Error al eliminar el cliente")}})}},53044:(e,r,a)=>{a.d(r,{X:()=>s});var t=a(90697);let n={users:"/users",userComplete:"/users/complete",user:e=>"/users/".concat(e),userProfile:e=>"/users/".concat(e,"/profile")},s={async getResearchClients(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new URLSearchParams;return r.append("type","clients"),r.append("page",(e.page||1).toString()),r.append("limit",(e.limit||10).toString()),e.search&&r.append("search",e.search),e.role&&r.append("role",e.role),void 0!==e.isActive&&r.append("isActive",e.isActive.toString()),await t.q.get("".concat(n.users,"?").concat(r.toString()))},getResearchClientById:async e=>await t.q.get(n.user(e)),async createResearchClient(e){try{return await t.q.post(n.userComplete,e)}catch(e){throw console.error("❌ Error al crear cliente:",e),e}},async updateResearchClientUser(e,r){try{return await t.q.patch(n.user(e),r)}catch(e){throw console.error("❌ Error al actualizar datos de usuario:",e),e}},async updateResearchClientProfile(e,r){try{return await t.q.patch(n.userProfile(e),r)}catch(e){throw console.error("❌ Error al actualizar perfil de usuario:",e),e}},async updateResearchClient(e,r){try{let a=null;return r.user&&(a=await this.updateResearchClientUser(e,r.user)),r.profile&&(a=await this.updateResearchClientProfile(e,r.profile)),a||(a=await this.getResearchClientById(e)),a}catch(e){throw console.error("❌ Error al actualizar cliente completo:",e),e}},async deleteResearchClient(e){try{await t.q.delete(n.user(e))}catch(e){throw console.error("❌ Error al eliminar cliente:",e),e}}}},72273:(e,r,a)=>{a.d(r,{Z:()=>v});var t=a(95155),n=a(12115),s=a(62177),i=a(90221),l=a(73162),o=a(54165),c=a(17759),d=a(59409),u=a(62523),m=a(30285),h=a(47262),p=a(51154),x=a(51775);let j=l.Ik({email:l.Yj().min(1,"El email es obligatorio").email("Email inv\xe1lido").max(100,"El email no puede exceder 100 caracteres"),isActive:l.zM(),firstName:l.Yj().min(1,"El nombre es obligatorio").min(2,"El nombre debe tener al menos 2 caracteres").max(50,"El nombre no puede exceder 50 caracteres"),lastName:l.Yj().min(1,"Los apellidos son obligatorios").min(2,"Los apellidos deben tener al menos 2 caracteres").max(50,"Los apellidos no pueden exceder 50 caracteres"),documentType:l.fc(Object.fromEntries(Object.entries({DNI:"DNI",PASSPORT:"PASSPORT",CE:"CE"}))),documentNumber:l.Yj().min(1,"El n\xfamero de documento es obligatorio").min(8,"El n\xfamero de documento debe tener al menos 8 caracteres").max(20,"El n\xfamero de documento no puede exceder 20 caracteres"),phone:l.Yj().min(1,"El tel\xe9fono es obligatorio").min(9,"El tel\xe9fono debe tener al menos 9 caracteres").max(20,"El tel\xe9fono no puede exceder 20 caracteres"),university:l.Yj().min(1,"La universidad es obligatoria").min(3,"La universidad debe tener al menos 3 caracteres").max(100,"La universidad no puede exceder 100 caracteres"),faculty:l.Yj().min(1,"La facultad es obligatoria").min(3,"La facultad debe tener al menos 3 caracteres").max(100,"La facultad no puede exceder 100 caracteres"),career:l.Yj().min(1,"La carrera es obligatoria").min(3,"La carrera debe tener al menos 3 caracteres").max(100,"La carrera no puede exceder 100 caracteres"),academicDegree:l.fc(Object.fromEntries(Object.entries({Bachiller:"Bachiller",Licenciado:"Licenciado",Magister:"Magister",Doctor:"Doctor"})))});function v(e){let{open:r,onOpenChange:a,onClientSaved:l,client:v=null,mode:g="create"}=e,C=(0,x.er)(),y=(0,x.tn)(),[f,N]=(0,n.useState)(!1),b=(0,s.mN)({resolver:(0,i.u)(j),defaultValues:{email:"",isActive:!0,firstName:"",lastName:"",documentType:"DNI",documentNumber:"",phone:"",university:"",faculty:"",career:"",academicDegree:"Bachiller"}});(0,n.useEffect)(()=>{"edit"===g&&v&&r?b.reset({email:v.email,isActive:v.isActive,firstName:v.profile.firstName,lastName:v.profile.lastName,documentType:v.profile.documentType,documentNumber:v.profile.documentNumber,phone:v.profile.phone,university:v.profile.university,faculty:v.profile.faculty,career:v.profile.career,academicDegree:v.profile.academicDegree}):"create"===g&&r&&b.reset({email:"",isActive:!0,firstName:"",lastName:"",documentType:"DNI",documentNumber:"",phone:"",university:"",faculty:"",career:"",academicDegree:"Bachiller"})},[g,v,r,b]);let w=async e=>{if(!f){N(!0);try{if("edit"===g&&v){let r={user:{email:e.email,isActive:e.isActive},profile:{firstName:e.firstName,lastName:e.lastName,documentType:e.documentType,documentNumber:e.documentNumber,phone:e.phone,university:e.university,faculty:e.faculty,career:e.career,academicDegree:e.academicDegree}};await y.mutateAsync({id:v.id,data:r})}else{let r={user:{email:e.email,password:"temporal123",role:"CLIENT",isActive:e.isActive},profile:{firstName:e.firstName,lastName:e.lastName,documentType:e.documentType,documentNumber:e.documentNumber,phone:e.phone,university:e.university,faculty:e.faculty,career:e.career,academicDegree:e.academicDegree}};await C.mutateAsync(r)}b.reset(),a(!1),l()}catch(e){console.error("Error en operaci\xf3n del cliente:",e)}finally{N(!1)}}},E=C.isPending||y.isPending||f;return(0,t.jsx)(o.lG,{open:r,onOpenChange:a,children:(0,t.jsxs)(o.Cf,{className:"sm:max-w-[700px] max-w-[95vw] max-h-[90vh] overflow-y-auto",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,t.jsxs)(o.c7,{className:"border-b pb-4",children:[(0,t.jsx)(o.L3,{children:"edit"===g?"Editar Cliente de Investigaci\xf3n":"Crear Nuevo Cliente de Investigaci\xf3n"}),(0,t.jsx)(o.rr,{children:"edit"===g?"Modifica la informaci\xf3n del cliente de investigaci\xf3n.":"Completa la informaci\xf3n para crear un nuevo cliente de investigaci\xf3n."})]}),(0,t.jsx)(c.lV,{...b,children:(0,t.jsxs)("form",{onSubmit:b.handleSubmit(w),className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Informaci\xf3n Personal"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(c.zB,{control:b.control,name:"firstName",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Nombres *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"Ingrese los nombres",...r})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"lastName",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Apellidos *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"Ingrese los apellidos",...r})}),(0,t.jsx)(c.C5,{})]})}})]}),(0,t.jsx)(c.zB,{control:b.control,name:"email",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Correo Electr\xf3nico *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{type:"email",placeholder:"correo@ejemplo.com",...r})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"phone",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Tel\xe9fono *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"999 999 999",...r})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(c.zB,{control:b.control,name:"documentType",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Tipo de Documento *"}),(0,t.jsxs)(d.l6,{onValueChange:r.onChange,defaultValue:r.value,children:[(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.bq,{children:(0,t.jsx)(d.yv,{placeholder:"Seleccionar tipo"})})}),(0,t.jsxs)(d.gC,{children:[(0,t.jsx)(d.eb,{value:"DNI",children:"DNI"}),(0,t.jsx)(d.eb,{value:"PASSPORT",children:"Pasaporte"}),(0,t.jsx)(d.eb,{value:"CE",children:"Carn\xe9 de Extranjer\xeda"})]})]}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"documentNumber",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"N\xfamero de Documento *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"12345678",...r})}),(0,t.jsx)(c.C5,{})]})}})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium",children:"Informaci\xf3n Acad\xe9mica"}),(0,t.jsx)(c.zB,{control:b.control,name:"university",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Universidad *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"Universidad Nacional Mayor de San Marcos",...r})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"faculty",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Facultad *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"Facultad de Ingenier\xeda",...r})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"career",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Carrera *"}),(0,t.jsx)(c.MJ,{children:(0,t.jsx)(u.p,{placeholder:"Ingenier\xeda de Sistemas",...r})}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"academicDegree",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{children:[(0,t.jsx)(c.lR,{children:"Grado Acad\xe9mico *"}),(0,t.jsxs)(d.l6,{onValueChange:r.onChange,defaultValue:r.value,children:[(0,t.jsx)(c.MJ,{children:(0,t.jsx)(d.bq,{children:(0,t.jsx)(d.yv,{placeholder:"Seleccionar grado"})})}),(0,t.jsxs)(d.gC,{children:[(0,t.jsx)(d.eb,{value:"Bachiller",children:"Bachiller"}),(0,t.jsx)(d.eb,{value:"Licenciado",children:"Licenciado"}),(0,t.jsx)(d.eb,{value:"Magister",children:"Magister"}),(0,t.jsx)(d.eb,{value:"Doctor",children:"Doctor"})]})]}),(0,t.jsx)(c.C5,{})]})}}),(0,t.jsx)(c.zB,{control:b.control,name:"isActive",render:e=>{let{field:r}=e;return(0,t.jsxs)(c.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,t.jsx)(c.MJ,{children:(0,t.jsx)(h.S,{checked:r.value,onCheckedChange:r.onChange})}),(0,t.jsx)("div",{className:"space-y-1 leading-none",children:(0,t.jsx)(c.lR,{children:"Cliente activo"})})]})}})]}),(0,t.jsxs)(o.Es,{className:"gap-2 border-t pt-4",children:[(0,t.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:E,children:"Cancelar"}),(0,t.jsxs)(m.$,{type:"submit",disabled:E,className:"text-white",children:[E&&(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===g?"Actualizar Cliente":"Crear Cliente"]})]})]})})]})})}}}]);