"use strict";exports.id=321,exports.ids=[321],exports.modules={30321:(a,b,c)=>{c.d(b,{Z:()=>r});var d=c(60687),e=c(43210),f=c(27605),g=c(63442),h=c(31692),i=c(63503),j=c(71669),k=c(15079),l=c(89667),m=c(29523),n=c(56896),o=c(41862),p=c(48199);let q=h.Ik({email:h.Yj().min(1,"El email es obligatorio").email("Email inv\xe1lido").max(100,"El email no puede exceder 100 caracteres"),isActive:h.zM(),firstName:h.Yj().min(1,"El nombre es obligatorio").min(2,"El nombre debe tener al menos 2 caracteres").max(50,"El nombre no puede exceder 50 caracteres"),lastName:h.Yj().min(1,"Los apellidos son obligatorios").min(2,"Los apellidos deben tener al menos 2 caracteres").max(50,"Los apellidos no pueden exceder 50 caracteres"),documentType:h.fc(Object.fromEntries(Object.entries({DNI:"DNI",PASSPORT:"PASSPORT",CE:"CE"}))),documentNumber:h.Yj().min(1,"El n\xfamero de documento es obligatorio").min(8,"El n\xfamero de documento debe tener al menos 8 caracteres").max(20,"El n\xfamero de documento no puede exceder 20 caracteres"),phone:h.Yj().min(1,"El tel\xe9fono es obligatorio").min(9,"El tel\xe9fono debe tener al menos 9 caracteres").max(20,"El tel\xe9fono no puede exceder 20 caracteres"),university:h.Yj().min(1,"La universidad es obligatoria").min(3,"La universidad debe tener al menos 3 caracteres").max(100,"La universidad no puede exceder 100 caracteres"),faculty:h.Yj().min(1,"La facultad es obligatoria").min(3,"La facultad debe tener al menos 3 caracteres").max(100,"La facultad no puede exceder 100 caracteres"),career:h.Yj().min(1,"La carrera es obligatoria").min(3,"La carrera debe tener al menos 3 caracteres").max(100,"La carrera no puede exceder 100 caracteres"),academicDegree:h.fc(Object.fromEntries(Object.entries({Bachiller:"Bachiller",Licenciado:"Licenciado",Magister:"Magister",Doctor:"Doctor"})))});function r({open:a,onOpenChange:b,onClientSaved:c,client:h=null,mode:r="create"}){let s=(0,p.er)(),t=(0,p.tn)(),[u,v]=(0,e.useState)(!1),w=(0,f.mN)({resolver:(0,g.u)(q),defaultValues:{email:"",isActive:!0,firstName:"",lastName:"",documentType:"DNI",documentNumber:"",phone:"",university:"",faculty:"",career:"",academicDegree:"Bachiller"}}),x=async a=>{if(!u){v(!0);try{if("edit"===r&&h){let b={user:{email:a.email,isActive:a.isActive},profile:{firstName:a.firstName,lastName:a.lastName,documentType:a.documentType,documentNumber:a.documentNumber,phone:a.phone,university:a.university,faculty:a.faculty,career:a.career,academicDegree:a.academicDegree}};await t.mutateAsync({id:h.id,data:b})}else{let b={user:{email:a.email,password:"temporal123",role:"CLIENT",isActive:a.isActive},profile:{firstName:a.firstName,lastName:a.lastName,documentType:a.documentType,documentNumber:a.documentNumber,phone:a.phone,university:a.university,faculty:a.faculty,career:a.career,academicDegree:a.academicDegree}};await s.mutateAsync(b)}w.reset(),b(!1),c()}catch(a){console.error("Error en operaci\xf3n del cliente:",a)}finally{v(!1)}}},y=s.isPending||t.isPending||u;return(0,d.jsx)(i.lG,{open:a,onOpenChange:b,children:(0,d.jsxs)(i.Cf,{className:"sm:max-w-[700px] max-w-[95vw] max-h-[90vh] overflow-y-auto",onPointerDownOutside:a=>a.preventDefault(),onEscapeKeyDown:a=>a.preventDefault(),children:[(0,d.jsxs)(i.c7,{className:"border-b pb-4",children:[(0,d.jsx)(i.L3,{children:"edit"===r?"Editar Cliente de Investigaci\xf3n":"Crear Nuevo Cliente de Investigaci\xf3n"}),(0,d.jsx)(i.rr,{children:"edit"===r?"Modifica la informaci\xf3n del cliente de investigaci\xf3n.":"Completa la informaci\xf3n para crear un nuevo cliente de investigaci\xf3n."})]}),(0,d.jsx)(j.lV,{...w,children:(0,d.jsxs)("form",{onSubmit:w.handleSubmit(x),className:"space-y-6",children:[(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-medium",children:"Informaci\xf3n Personal"}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:w.control,name:"firstName",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Nombres *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"Ingrese los nombres",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"lastName",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Apellidos *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"Ingrese los apellidos",...a})}),(0,d.jsx)(j.C5,{})]})})]}),(0,d.jsx)(j.zB,{control:w.control,name:"email",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Correo Electr\xf3nico *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{type:"email",placeholder:"correo@ejemplo.com",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"phone",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Tel\xe9fono *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"999 999 999",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsx)(j.zB,{control:w.control,name:"documentType",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Tipo de Documento *"}),(0,d.jsxs)(k.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.bq,{children:(0,d.jsx)(k.yv,{placeholder:"Seleccionar tipo"})})}),(0,d.jsxs)(k.gC,{children:[(0,d.jsx)(k.eb,{value:"DNI",children:"DNI"}),(0,d.jsx)(k.eb,{value:"PASSPORT",children:"Pasaporte"}),(0,d.jsx)(k.eb,{value:"CE",children:"Carn\xe9 de Extranjer\xeda"})]})]}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"documentNumber",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"N\xfamero de Documento *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"12345678",...a})}),(0,d.jsx)(j.C5,{})]})})]})]}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsx)("h3",{className:"text-lg font-medium",children:"Informaci\xf3n Acad\xe9mica"}),(0,d.jsx)(j.zB,{control:w.control,name:"university",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Universidad *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"Universidad Nacional Mayor de San Marcos",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"faculty",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Facultad *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"Facultad de Ingenier\xeda",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"career",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Carrera *"}),(0,d.jsx)(j.MJ,{children:(0,d.jsx)(l.p,{placeholder:"Ingenier\xeda de Sistemas",...a})}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"academicDegree",render:({field:a})=>(0,d.jsxs)(j.eI,{children:[(0,d.jsx)(j.lR,{children:"Grado Acad\xe9mico *"}),(0,d.jsxs)(k.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(k.bq,{children:(0,d.jsx)(k.yv,{placeholder:"Seleccionar grado"})})}),(0,d.jsxs)(k.gC,{children:[(0,d.jsx)(k.eb,{value:"Bachiller",children:"Bachiller"}),(0,d.jsx)(k.eb,{value:"Licenciado",children:"Licenciado"}),(0,d.jsx)(k.eb,{value:"Magister",children:"Magister"}),(0,d.jsx)(k.eb,{value:"Doctor",children:"Doctor"})]})]}),(0,d.jsx)(j.C5,{})]})}),(0,d.jsx)(j.zB,{control:w.control,name:"isActive",render:({field:a})=>(0,d.jsxs)(j.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,d.jsx)(j.MJ,{children:(0,d.jsx)(n.S,{checked:a.value,onCheckedChange:a.onChange})}),(0,d.jsx)("div",{className:"space-y-1 leading-none",children:(0,d.jsx)(j.lR,{children:"Cliente activo"})})]})})]}),(0,d.jsxs)(i.Es,{className:"gap-2 border-t pt-4",children:[(0,d.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>b(!1),disabled:y,children:"Cancelar"}),(0,d.jsxs)(m.$,{type:"submit",disabled:y,className:"text-white",children:[y&&(0,d.jsx)(o.A,{className:"mr-2 h-4 w-4 animate-spin"}),"edit"===r?"Actualizar Cliente":"Crear Cliente"]})]})]})})]})})}},48199:(a,b,c)=>{c.d(b,{bL:()=>n,eH:()=>j,er:()=>l,r8:()=>k,tn:()=>m});var d=c(12030),e=c(8693),f=c(54050),g=c(52581),h=c(93970);let i={researchClientsWithFilters:a=>["research-clients",a],researchClientsStats:["research-clients","stats"]},j=()=>(0,d.useQuery)({queryKey:i.researchClientsStats,queryFn:async()=>{let a=(await h.X.getResearchClients({limit:1e3})).data,b=new Date,c=new Date(b.getFullYear(),b.getMonth(),1);return{totalClients:a.length,activeClients:a.filter(a=>a.isActive).length,inactiveClients:a.filter(a=>!a.isActive).length,thisMonthClients:a.filter(a=>new Date(a.createdAt)>=c).length}},retry:1,refetchOnWindowFocus:!1}),k=(a={})=>(0,d.useQuery)({queryKey:i.researchClientsWithFilters(a),queryFn:()=>h.X.getResearchClients(a),retry:1,refetchOnWindowFocus:!1}),l=()=>{let a=(0,e.useQueryClient)();return(0,f.useMutation)({mutationFn:a=>h.X.createResearchClient(a),onSuccess:()=>{g.oR.success("Cliente de investigaci\xf3n creado exitosamente"),a.invalidateQueries({queryKey:["research-clients"]})},onError:a=>{console.error("Error creating research client:",a);let b=a?.response?.data?.message||a?.message||"";b.toLowerCase().includes("email")&&b.toLowerCase().includes("exist")?g.oR.error("❌ Este email ya est\xe1 registrado en el sistema"):b.toLowerCase().includes("validation")||b.toLowerCase().includes("required")||b.toLowerCase().includes("invalid")?g.oR.error("❌ Datos inv\xe1lidos: Verifica que todos los campos est\xe9n correctos"):b.toLowerCase().includes("document")&&b.toLowerCase().includes("exist")?g.oR.error("❌ Este n\xfamero de documento ya est\xe1 registrado"):g.oR.error(b||"Error al crear el cliente. Intenta nuevamente.")}})},m=()=>{let a=(0,e.useQueryClient)();return(0,f.useMutation)({mutationFn:({id:a,data:b})=>h.X.updateResearchClient(a,b),onSuccess:()=>{g.oR.success("Cliente de investigaci\xf3n actualizado exitosamente"),a.invalidateQueries({queryKey:["research-clients"]})},onError:a=>{console.error("Error updating research client:",a);let b=a?.response?.data?.message||a?.message||"";b.toLowerCase().includes("email")&&b.toLowerCase().includes("exist")?g.oR.error("❌ Este email ya est\xe1 registrado por otro usuario"):b.toLowerCase().includes("validation")||b.toLowerCase().includes("required")||b.toLowerCase().includes("invalid")?g.oR.error("❌ Datos inv\xe1lidos: Verifica que todos los campos est\xe9n correctos"):b.toLowerCase().includes("not found")||b.toLowerCase().includes("no encontrado")?g.oR.error("❌ Cliente no encontrado"):b.toLowerCase().includes("document")&&b.toLowerCase().includes("exist")?g.oR.error("❌ Este n\xfamero de documento ya est\xe1 registrado"):g.oR.error(b||"Error al actualizar el cliente. Intenta nuevamente.")}})},n=()=>{let a=(0,e.useQueryClient)();return(0,f.useMutation)({mutationFn:a=>h.X.deleteResearchClient(a),onSuccess:()=>{g.oR.success("Cliente de investigaci\xf3n eliminado correctamente"),a.invalidateQueries({queryKey:["research-clients"]})},onError:a=>{console.error("Error deleting research client:",a);let b=a?.response?.data?.message||a?.message||"";b.toLowerCase().includes("not found")?g.oR.error("❌ Cliente no encontrado"):b.toLowerCase().includes("constraint")||b.toLowerCase().includes("referenced")?g.oR.error("❌ No se puede eliminar: El cliente tiene registros asociados"):g.oR.error(b||"Error al eliminar el cliente")}})}},93970:(a,b,c)=>{c.d(b,{X:()=>f});var d=c(86401);let e={users:"/users",userComplete:"/users/complete",user:a=>`/users/${a}`,userProfile:a=>`/users/${a}/profile`},f={async getResearchClients(a={}){let b=new URLSearchParams;return b.append("type","clients"),b.append("page",(a.page||1).toString()),b.append("limit",(a.limit||10).toString()),a.search&&b.append("search",a.search),a.role&&b.append("role",a.role),void 0!==a.isActive&&b.append("isActive",a.isActive.toString()),await d.q.get(`${e.users}?${b.toString()}`)},getResearchClientById:async a=>await d.q.get(e.user(a)),async createResearchClient(a){try{return await d.q.post(e.userComplete,a)}catch(a){throw console.error("❌ Error al crear cliente:",a),a}},async updateResearchClientUser(a,b){try{return await d.q.patch(e.user(a),b)}catch(a){throw console.error("❌ Error al actualizar datos de usuario:",a),a}},async updateResearchClientProfile(a,b){try{return await d.q.patch(e.userProfile(a),b)}catch(a){throw console.error("❌ Error al actualizar perfil de usuario:",a),a}},async updateResearchClient(a,b){try{let c=null;return b.user&&(c=await this.updateResearchClientUser(a,b.user)),b.profile&&(c=await this.updateResearchClientProfile(a,b.profile)),c||(c=await this.getResearchClientById(a)),c}catch(a){throw console.error("❌ Error al actualizar cliente completo:",a),a}},async deleteResearchClient(a){try{await d.q.delete(e.user(a))}catch(a){throw console.error("❌ Error al eliminar cliente:",a),a}}}}};